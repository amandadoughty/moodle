{"version":3,"sources":["../src/custom.js"],"names":["define","$","initialise","document","ready","mainregion","addregion","strings","save","update","req","preview","title","message","on","e","preventDefault","senddata","call","purpose","tableaction","eattr","closest","attr","dattr","refreshRequired","savebutton","addClass","val","callpath","M","cfg","wwwroot","sesskey","post","fail","console","error","done","data","JSON","parse","parseInt","fadeOut","remove","clearForm","refreshPreview","i","hasOwnProperty","form","prepend","affectelement","find","prop","reloadPreview","rattr","pdattr","status","checkRequired","show","serialize","responseJSON","sfield","insertAfter","nextSibling","hide","setTimeout","load","length","innerHTML","alerttype","previewalert","removeClass","util","image_url","checked","previewelem","previewdom","prependTo","slideDown","disselopt","opt","reset","init","always","append"],"mappings":"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","sourcesContent":["/* eslint no-console: [\"error\", { allow: [\"error\"] }] */\n/**\n * @package    block_advnotifications\n * @copyright  2019 onwards LearningWorks Ltd {@link https://learningworks.co.nz/}\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @author     Zander Potgieter <zander.potgieter@learningworks.co.nz>\n */\n\n/**\n * @module block_advnotifications/custom\n */\ndefine(['jquery'], function($) {\n    // JQuery is available via $.\n\n    return {\n        initialise: function() {\n            // Module initialised.\n            $(document).ready(function() {\n                // Commonly (multiple times) used elements.\n                var mainregion = $('#region-main');\n                var addregion = $('#add_notification_wrapper_id');\n                var strings = {\n                    save: 'Save',\n                    update: 'Update',\n                    req: 'Required field...',\n                    preview: 'Preview',\n                    title: 'Title',\n                    message: 'Message'\n                };\n\n                // MANAGING NOTIFICATIONS.\n                mainregion.on('click', '.notifications_table tr > td > form > input[type=submit]', function(e) {\n                    e.preventDefault();\n                    var senddata = {}; // Data Object.\n                    senddata.call = 'ajax';\n                    senddata.purpose = '';\n                    senddata.tableaction = '';\n\n                    // Check if user wants to edit/delete.\n                    var eattr = $(this).closest('form').attr('data-edit');\n                    var dattr = $(this).closest('form').attr('data-delete');\n                    refreshRequired();\n\n                    // Check if anchor element has attribute, retrieved from above.\n                    if (typeof eattr !== typeof undefined && eattr !== false) {\n                        senddata.purpose = 'edit';\n                        senddata.tableaction = eattr;\n\n                        var savebutton = $('#add_notification_save');\n                        savebutton.addClass('update');\n                        savebutton.val(strings.update);\n                    } else if (typeof dattr !== typeof undefined && dattr !== false) {\n                        senddata.purpose = 'delete';\n                        senddata.tableaction = dattr;\n                    }\n\n                    var callpath = M.cfg.wwwroot + \"/blocks/advnotifications/pages/process.php?sesskey=\" + M.cfg.sesskey;\n\n                    // Perform tableaction.\n                    $.post(callpath, senddata).fail(function() {\n                        console.error(\"No 'manage' response received.\");\n                    }).done(function(data) {\n                        data = JSON.parse(data);\n\n                        // User deleted/edited notification.\n                        if (parseInt(data.done, 10) > 0) {\n                            $('#tr' + data.done).closest(\"tr\").fadeOut(250, function() {\n                                $(this).remove();\n                                clearForm();\n                                refreshPreview();\n                            });\n                        } else if (senddata.purpose === \"edit\") {\n                            for (var i in data) {\n                                if (data.hasOwnProperty(i)) {\n\n                                    // Need this for updating.\n                                    if (i === \"id\") {\n                                        var form = $('#add_notification_form');\n\n                                        // Because we're doing a standard submit, we need extra inputs to pass params.\n                                        // But first, remove old hidden inputs.\n                                        $('#add_notification_id').remove();\n                                        form.prepend('<input type=\"hidden\" id=\"add_notification_id\" name=\"id\" value=\"' + data[i] + '\"/>');\n\n                                        $('#add_notification_purpose').val('update');\n                                    }\n\n                                    var affectelement = $('#add_notification_wrapper_id').find('#add_notification_' + i);\n\n                                    // Check whether checkboxes should be checked or not.\n                                    // We also don't assign a value to checkbox input fields.\n                                    if ((i === 'enabled' || i === 'global' || i === 'dismissible' || i === 'aicon') && data[i] == 1) {\n                                        affectelement.prop('checked', true);\n                                    } else if ((i === 'enabled' || i === 'global' || i === 'dismissible' || i === 'aicon') && data[i] == 0) {\n                                        affectelement.prop('checked', false);\n                                    } else {\n                                        affectelement.val(data[i]);\n                                    }\n                                }\n                            }\n                            reloadPreview();\n                        }\n                    });\n                });\n\n                // Restore & Permanently delete notifications.\n                mainregion.on('click', '.notifications_restore_table tr > td > form > input[type=submit]', function(e) {\n\n                    e.preventDefault();\n                    var senddata = {}; // Data Object.\n                    senddata.call = 'ajax';\n                    senddata.purpose = '';\n                    senddata.tableaction = '';\n\n                    // Check if user wants to restore/delete.\n                    var rattr = $(this).closest('form').attr('data-restore');\n                    var pdattr = $(this).closest('form').attr('data-permdelete');\n\n                    // Check if anchor element has attribute, retrieved from above.\n                    if (typeof rattr !== typeof undefined && rattr !== false) {\n                        senddata.purpose = 'restore';\n                        senddata.tableaction = rattr;\n                    } else if (typeof pdattr !== typeof undefined && pdattr !== false) {\n                        senddata.purpose = 'permdelete';\n                        senddata.tableaction = pdattr;\n                    }\n\n                    var callpath = M.cfg.wwwroot + \"/blocks/advnotifications/pages/process.php?sesskey=\" + M.cfg.sesskey;\n\n                    // Perform tableaction.\n                    $.post(callpath, senddata).fail(function() {\n                        console.error(\"No 'restore/permdelete' response received.\");\n                    }).done(function(data) {\n                        data = JSON.parse(data);\n\n                        // User deleted/restored notification.\n                        // Object 'done' is returned for both restore & delete.\n                        if (parseInt(data.done, 10) > 0) {\n                            $('#tr' + data.done).closest(\"tr\").fadeOut(250, function() {\n                                $(this).remove();\n                            });\n                        }\n                    });\n                });\n\n                // Clear form.\n                addregion.on('click', '#add_notification_cancel', function(e) {\n                    e.preventDefault();\n                    clearForm();\n                });\n\n                // Managing more notifications.\n                mainregion.on('submit', '#add_notification_form', function(e) {\n                    e.preventDefault();\n                    var status = $('#add_notification_status');\n                    var form = $('#add_notification_form');\n\n                    refreshRequired();\n                    if (!checkRequired()) {\n                        // Stop if required fields are not supplied.\n                        return;\n                    }\n\n                    status.show();\n\n                    var senddata = $(this).serialize(); // Data Object.\n\n                    var callpath = M.cfg.wwwroot + \"/blocks/advnotifications/pages/process.php\";\n\n                    // Perform tableaction.\n                    $.post(callpath, senddata).fail(function(data) {\n                        console.error(\"No 'add' response received.\");\n\n                        var error = data.responseJSON.error;\n\n                        for (var i in error) {\n                            if (error.hasOwnProperty(i)) {\n                                var sfield = form.find('select[name=' + error[i] + ']');\n                                sfield.addClass('requiredfield');\n                                $('<strong class=\"requiredfield\"><em>' + strings.req + '</em><strong>').insertAfter(sfield[0].nextSibling);\n                            }\n                        }\n\n                        status.hide();\n                    }).done(function() {\n                        // User saved notification.\n                        status.find('.saving').hide();\n                        status.find('.done').show();\n\n                        // Clear Form.\n                        clearForm();\n\n                        setTimeout(function() {\n                            status.fadeOut(function() {\n                                status.find('.done').hide();\n                                status.find('.saving').show();\n                            });\n                        }, 1500);\n\n                        $('#advnotifications_table_wrapper').load('# #advnotifications_table_wrapper > *');\n                    });\n                });\n\n                // LIVE PREVIEW.\n                // Dynamically update preview alert as user changes textbox content.\n                addregion.on('input propertychange paste', '#add_notification_title, #add_notification_message', function() {\n                    reloadPreview();\n                });\n\n                // Dynamically update preview alert type.\n                $('#add_notification_type').on('change', function() {\n                    reloadPreview();\n                });\n\n                $('#add_notification_dismissible').on('change', function() {\n                    // Checking specifically whether ticked/checked or not to ensure it's displayed correctly (not toggling).\n                    reloadPreview();\n                });\n\n                $('#add_notification_aicon').on('change', function() {\n                    // Checking specifically whether ticked/checked or not to ensure it's displayed correctly (not toggling).\n                    reloadPreview();\n                });\n\n                // Check if preview is displaying correct (Update it).\n                var reloadPreview = function() {\n                    // Update title.\n                    var title = addregion.find('#add_notification_title');\n                    if (title.val().length > 0) {\n                        addregion.find('.preview-title')[0].innerHTML = title.val();\n                    } else {\n                        addregion.find('.preview-title')[0].innerHTML = strings.title;\n                    }\n\n                    // Update message.\n                    var message = addregion.find('#add_notification_message');\n                    if (message.val().length > 0) {\n                        addregion.find('.preview-message')[0].innerHTML = message.val();\n                    } else {\n                        addregion.find('.preview-message')[0].innerHTML = strings.message;\n                    }\n\n                    // Check notification type.\n                    var alerttype = $('#add_notification_type').val();\n                    var previewalert = $('#add_notification_wrapper_id .preview-alert');\n\n                    // Clear existing classes.\n                    previewalert.removeClass('alert-info alert-success alert-danger alert-warning announcement');\n\n                    // Special check for announcement type.\n                    if (alerttype === 'announcement') {\n                        previewalert.addClass(alerttype);\n                        alerttype = 'info';\n                    }\n\n                    // If anything unexpected, set to info type.\n                    if (alerttype !== 'info' && alerttype !== 'success' && alerttype !== 'warning' && alerttype !== 'danger') {\n                        alerttype = 'info';\n                    }\n\n                    // Add type of alert class.\n                    previewalert.addClass('alert-' + alerttype);\n\n                    $('.preview-aicon').find('> img').attr('src', M.util.image_url(alerttype, 'block_advnotifications'));\n\n                    // Check if dismissable.\n                    if (!$('#add_notification_dismissible')[0].checked) {\n                        $('.preview-alert-dismissible').hide();\n                    } else {\n                        $('.preview-alert-dismissible').show();\n                    }\n\n                    // Check if icon should be shown.\n                    if (!$('#add_notification_aicon')[0].checked) {\n                        $('.preview-aicon').hide();\n                    } else {\n                        $('.preview-aicon').show();\n                    }\n                };\n\n                var init = function() {\n                    // Get strings.\n                    var senddata = {}; // Data Object.\n                    senddata.call = 'ajax';\n                    senddata.purpose = 'strings';\n\n                    var callpath = M.cfg.wwwroot + \"/blocks/advnotifications/pages/process.php?sesskey=\" + M.cfg.sesskey;\n\n                    $.post(callpath, senddata).fail(function() {\n                        console.error(\"No 'strings' response received.\");\n                    }).done(function(data) {\n                        // Store strings and update preview (TODO: ONLY DO THIS IF AJAX SUCCESSFUL - don't render with English first?).\n                        strings = data;\n                    }).always(function() {\n                        // Always prepend live preview. Will use langstrings if AJAX successful, otherwise the strings declared at top.\n                        refreshPreview();\n                    });\n\n                    // JS is enabled, so we can use AJAX in the new notification form.\n                    $('#add_notification_form').append('<input type=\"hidden\" id=\"add_notification_call\" name=\"call\" value=\"ajax\"/>');\n                };\n\n                // Shiny new and fresh preview.\n                var refreshPreview = function() {\n                    var previewelem = $('#notification_preview_wrapper');\n                    var previewdom = '<div id=\"notification_preview_wrapper\"><strong>' + strings.preview + '</strong><br><div class=\"alert alert-info preview-alert\"><div class=\"preview-aicon\" style=\"display: none;\"><img src=\"' + M.util.image_url('info', 'block_advnotifications') + '\" /></div><strong class=\"preview-title\">' + strings.title + '</strong> <div class=\"preview-message\">' + strings.message + '</div> <div class=\"preview-alert-dismissible\" style=\"display: none;\"><strong>&times;</strong></div></div></div>';\n\n                    // If it exists already, remove before adding again.\n                    if (previewelem.length > 0) {\n                        previewelem.remove();\n                        // Don't slide in.\n                        $(previewdom).prependTo($(addregion));\n                    } else {\n                        // Slide in.\n                        $(previewdom).prependTo($(addregion)).hide().slideDown();\n                    }\n                };\n\n                var checkRequired = function() {\n                    var disselopt = $('#add_notification_form select option:selected:disabled');\n\n                    for (var opt in disselopt) {\n                        if (disselopt.hasOwnProperty(opt)) {\n                            if ($(disselopt[opt]).prop('disabled')) {\n                                $(disselopt[opt]).closest('select').addClass('requiredfield');\n                                $('<strong class=\"requiredfield\"><em>' + strings.req + '</em><strong>')\n                                    .insertAfter($(disselopt[opt]).closest('select')[0].nextSibling);\n\n                                return false;\n                            }\n                        }\n                    }\n                    return true;\n                };\n\n                var refreshRequired = function() {\n                    $('select.requiredfield').removeClass('requiredfield');\n                    $('strong.requiredfield').remove();\n                };\n\n                var clearForm = function() {\n                    $('#add_notification_form')[0].reset();\n                    refreshRequired();\n                    refreshPreview();\n\n                    // Change save button back to normal.\n                    var savebutton = $('#add_notification_save');\n                    savebutton.removeClass('update');\n                    $('#add_notification_id').remove();\n                    $('#add_notification_purpose').val('add');\n\n                    savebutton.val(strings.save);\n                };\n\n                init();\n            });\n        }\n    };\n});"],"file":"custom.min.js"}