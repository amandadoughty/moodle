define ("block_culcourse_listing/category",["jquery","core/ajax","core/templates","core/str","core/url","core/yui","core/notification"],function(a,b,c,d,e,f,g){var h={CONTENTNODE:"content",COLLAPSEALL:"culcollapse-all",DISABLED:"disabled",LOADED:"loaded",NOTLOADED:"notloaded",SECTIONCOLLAPSED:"collapsed",HASCHILDREN:"with_children",HIDE:"hide"},i={LOADEDTREES:".with_children.loaded",CONTENTNODE:".content",CATEGORYCHILDLINK:".culcategory .info .categoryname a",CATEGORYLISTENLINK:".culcategory .info .categoryname",CATEGORYSPINNERLOCATION:".categoryname",CATEGORYWITHCOLLAPSEDLOADEDCHILDREN:".culcategory.with_children.loaded.collapsed",CATEGORYWITHMAXIMISEDLOADEDCHILDREN:".culcategory.with_children.loaded:not(.collapsed)",COLLAPSEEXPAND:".culcollapseexpand",COURSEBOX:".culcoursebox",COURSEBOXLISTENLINK:".culcoursebox .moreinfo",COURSEBOXSPINNERLOCATION:".coursename a",COURSECATEGORYTREE:".course_category_tree",PARENTWITHCHILDREN:".culcategory",SPINNER:".progress-icon"},j=M.cfg.wwwroot+"/blocks/culcourse_listing/category_ajax.php",k=function(){f.one(f.config.doc).delegate("key",m,"enter",i.CATEGORYLISTENLINK,this);f.one(f.config.doc).delegate("key",l,"enter",i.COURSEBOXLISTENLINK,this);f.one(f.config.doc).delegate("key",p,"enter",i.COLLAPSEEXPAND,this)},l=function(a){var b=a.target.ancestor(i.COURSEBOX,!0);a.preventDefault();if(b.hasClass(h.LOADED)){o(b);return}n({parentnode:b,childnode:b.one(i.CONTENTNODE),spinnerhandle:i.COURSEBOXSPINNERLOCATION,spinner:i.SPINNER,data:{sesskey:M.cfg.sesskey,courseid:b.getData("courseid"),type:1}})},m=function(a){var b,c,d;if(a.target.test("a")||a.target.test("img")){}b=a.target.ancestor(i.PARENTWITHCHILDREN,!0);if(!b.hasClass(h.HASCHILDREN)){return}if(b.hasClass(h.LOADED)){o(b);return}c=b.getData("categoryid");d=b.getData("depth");if("undefined"==typeof c||"undefined"==typeof d){return}n({parentnode:b,childnode:b.one(i.CONTENTNODE),spinnerhandle:i.CATEGORYSPINNERLOCATION,spinner:i.SPINNER,data:{sesskey:M.cfg.sesskey,categoryid:c,depth:d,showcourses:b.getData("showcourses"),type:0}})},n=function(b){var e=this;d.get_string("loading","core").then(function(a){return c.renderPix("i/progressbar","core",a)}).then(function(c){var d=b.parentnode.one(b.spinnerhandle),e=a(c).addClass("progress-icon");d.append(e);return e}).then(function(c){var d={},f={},g=a("#culcourse_listing_filter_year"),h=a("#culcourse_listing_filter_period");if(g){a.each(g.attr("options"),function(a,b){d[b]=a});b.data.years=JSON.stringify(d)}if(h){a.each(h.attr("options"),function(a,b){f[b]=a});b.data.periods=JSON.stringify(f)}var i={parentnode:b.parentnode,childnode:b.childnode,spinnernode:c};a.ajax({url:j,method:"POST",data:b.data,context:e,success:function success(a){t(a,i)}})}).fail(g.exception)},o=function(a){f.use("anim-node-plugin",function(){var b=a.one(i.CONTENTNODE),c=a.ancestor(i.COURSECATEGORYTREE);u(b);if(a.hasClass(h.SECTIONCOLLAPSED)){b.setStyle("height","0");a.removeClass(h.SECTIONCOLLAPSED);a.setAttribute("aria-expanded","true");b.fx.set("reverse",!1)}else{b.fx.set("reverse",!0);b.fx.once("end",function(a,b){b.addClass(h.SECTIONCOLLAPSED);b.setAttribute("aria-expanded","false")},this,a)}b.fx.once("end",function(a,b){b.setStyles({height:"",opacity:""});this.destroy();s(c)},b.fx,b);b.fx.run()})},p=function(a){a.preventDefault();if(a.currentTarget.hasClass(h.DISABLED)){return}var b=a.currentTarget.ancestor(i.COURSECATEGORYTREE);if(!b){return}var c=b.one(i.COLLAPSEEXPAND);if(c.hasClass(h.COLLAPSEALL)){r(b)}else{q(b)}s(b)},q=function(a){var b=[];a.all(i.CATEGORYWITHCOLLAPSEDLOADEDCHILDREN).each(function(a){if(a.ancestor(i.CATEGORYWITHCOLLAPSEDLOADEDCHILDREN)){a.removeClass(h.SECTIONCOLLAPSED);a.all(i.LOADEDTREES).removeClass(h.SECTIONCOLLAPSED)}else{b.push(a)}},this);f.all(b).each(function(a){o(a)},this)},r=function(a){var b=[];a.all(i.CATEGORYWITHMAXIMISEDLOADEDCHILDREN).each(function(a){if(a.ancestor(i.CATEGORYWITHMAXIMISEDLOADEDCHILDREN)){b.push(a)}else{o(a)}},this);f.all(b).each(function(a){a.addClass(h.SECTIONCOLLAPSED);a.all(i.LOADEDTREES).addClass(h.SECTIONCOLLAPSED)},this)},s=function(a){if(!a){return}var b=!1,c=a.one(i.COLLAPSEEXPAND);if(!c){return}a.all(i.CATEGORYWITHMAXIMISEDLOADEDCHILDREN).each(function(a){if(a.ancestor(i.CATEGORYWITHCOLLAPSEDLOADEDCHILDREN)){return!1}b=!0;return!0},this);c.removeClass(h.HIDE);if(b){c.setHTML(M.util.get_string("collapseall","moodle")).addClass(h.COLLAPSEALL).removeClass(h.DISABLED)}else{c.setHTML(M.util.get_string("expandall","moodle")).removeClass(h.COLLAPSEALL).removeClass(h.DISABLED)}},t=function(a,b){var c;try{if(a.error){return new M.core.ajaxException(a)}}catch(a){return new M.core.exception(a)}c=f.Node.create(a.content);b.childnode.appendChild(c);b.parentnode.addClass(h.LOADED).removeClass(h.NOTLOADED);o(b.parentnode);if(a.filterform){var d=f.one(".filter");d.setHTML(a.filterform)}if(b.spinnernode){b.spinnernode.hide()}},u=function(a){if("undefined"!=typeof a.fx){return a}a.plug(f.Plugin.NodeFX,{from:{height:0,opacity:0},to:{height:function height(a){return a.get("scrollHeight")},opacity:1},duration:.2});return a};return{initializer:function initializer(a){this.BLOCKCONFIG=a.config;var b=f.one(f.config.doc);b.delegate("click",function(a){a.preventDefault()},i.CATEGORYCHILDLINK,this);b.delegate("click",m,i.CATEGORYLISTENLINK,this);b.delegate("click",l,i.COURSEBOXLISTENLINK,this);b.delegate("click",p,i.COLLAPSEEXPAND,this);b.once("key",k,"tab",this)}}});
//# sourceMappingURL=category.min.js.map
