{"version":3,"sources":["../src/category.js"],"names":["define","$","ajax","Templates","Str","url","Y","Notification","CSS","CONTENTNODE","COLLAPSEALL","DISABLED","LOADED","NOTLOADED","SECTIONCOLLAPSED","HASCHILDREN","HIDE","SELECTORS","LOADEDTREES","CATEGORYCHILDLINK","CATEGORYLISTENLINK","CATEGORYSPINNERLOCATION","CATEGORYWITHCOLLAPSEDLOADEDCHILDREN","CATEGORYWITHMAXIMISEDLOADEDCHILDREN","COLLAPSEEXPAND","COURSEBOX","COURSEBOXLISTENLINK","COURSEBOXSPINNERLOCATION","COURSECATEGORYTREE","PARENTWITHCHILDREN","SPINNER","URL","M","cfg","wwwroot","setup_keyboard_listeners","one","config","doc","delegate","toggle_category_expansion","toggle_coursebox_expansion","collapse_expand_all","e","courseboxnode","target","ancestor","preventDefault","hasClass","run_expansion","_toggle_generic_expansion","parentnode","childnode","spinnerhandle","spinner","data","sesskey","courseid","getData","type","categorynode","categoryid","depth","test","showcourses","self","get_string","then","string","renderPix","html","node","spinnernode","addClass","append","years","periods","yearselect","periodselect","each","attr","key","value","JSON","stringify","args","method","context","success","response","process_results","fail","exception","use","categorychildren","add_animation","setStyle","removeClass","setAttribute","fx","set","once","setStyles","height","opacity","destroy","update_collapsible_actions","run","currentTarget","collapseall","collapse_all","expand_all","finalexpansions","all","c","push","finalcollapses","foundmaximisedchildren","togglelink","n","setHTML","util","newnode","error","core","ajaxException","Node","create","content","appendChild","filterform","hide","plug","Plugin","NodeFX","from","to","get","duration","initializer","params","BLOCKCONFIG"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * A javascript module to ...\n *\n * @package    block_culcourse_listing\n * @copyright  2019 Amanda Doughty\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/ajax', 'core/templates', 'core/str', 'core/url', 'core/yui', 'core/notification'],\n    function($, ajax, Templates, Str, url, Y, Notification) {\n\n    var CSS = {\n        CONTENTNODE: 'content',\n        COLLAPSEALL: 'culcollapse-all',\n        DISABLED: 'disabled',\n        LOADED: 'loaded',\n        NOTLOADED: 'notloaded',\n        SECTIONCOLLAPSED: 'collapsed',\n        HASCHILDREN: 'with_children',\n        HIDE: 'hide'\n    };\n    var SELECTORS = {\n        LOADEDTREES: '.with_children.loaded',\n        CONTENTNODE: '.content',\n        CATEGORYCHILDLINK: '.culcategory .info .categoryname a',\n        CATEGORYLISTENLINK: '.culcategory .info .categoryname',\n        CATEGORYSPINNERLOCATION: '.categoryname',\n        CATEGORYWITHCOLLAPSEDLOADEDCHILDREN: '.culcategory.with_children.loaded.collapsed',\n        CATEGORYWITHMAXIMISEDLOADEDCHILDREN: '.culcategory.with_children.loaded:not(.collapsed)',\n        COLLAPSEEXPAND: '.culcollapseexpand',\n        COURSEBOX: '.culcoursebox',\n        COURSEBOXLISTENLINK: '.culcoursebox .moreinfo',\n        COURSEBOXSPINNERLOCATION: '.coursename a',\n        COURSECATEGORYTREE: '.course_category_tree',\n        PARENTWITHCHILDREN: '.culcategory',\n        SPINNER: '.progress-icon'\n    };\n    var TYPE_CATEGORY = 0;\n    var TYPE_COURSE = 1;\n    var URL = M.cfg.wwwroot + '/blocks/culcourse_listing/category_ajax.php';\n\n    /**\n     * Set up keyboard expansion for course content.\n     *\n     * This includes setting up the delegation but also adding the nodes to the\n     * tabflow.\n     *\n     * @method setup_keyboard_listeners\n     */\n    var setup_keyboard_listeners = function() {\n        Y.one(Y.config.doc).delegate('key', toggle_category_expansion, 'enter', SELECTORS.CATEGORYLISTENLINK, this);\n        Y.one(Y.config.doc).delegate('key', toggle_coursebox_expansion, 'enter', SELECTORS.COURSEBOXLISTENLINK, this);\n        Y.one(Y.config.doc).delegate('key', collapse_expand_all, 'enter', SELECTORS.COLLAPSEEXPAND, this);\n    };\n\n    var toggle_coursebox_expansion = function(e) {\n        var courseboxnode;\n\n        // Grab the parent category container - this is where the new content will be added.\n        courseboxnode = e.target.ancestor(SELECTORS.COURSEBOX, true);\n        e.preventDefault();\n\n        if (courseboxnode.hasClass(CSS.LOADED)) {\n            // We've already loaded this content so we just need to toggle the view of it.\n            run_expansion(courseboxnode);\n            return;\n        }\n\n        _toggle_generic_expansion({\n            parentnode: courseboxnode,\n            childnode: courseboxnode.one(SELECTORS.CONTENTNODE),\n            spinnerhandle: SELECTORS.COURSEBOXSPINNERLOCATION,\n            spinner: SELECTORS.SPINNER,\n            data: {\n                sesskey : M.cfg.sesskey,\n                courseid: courseboxnode.getData('courseid'),\n                type: TYPE_COURSE\n            }\n        });\n    };\n\n    var toggle_category_expansion = function(e) {\n\n        var categorynode,\n            categoryid,\n            depth;\n\n        if (e.target.test('a') || e.target.test('img')) {\n            // Return early if either an anchor or an image were clicked.\n            //return;\n        }\n\n        // Grab the parent category container - this is where the new content will be added.\n        categorynode = e.target.ancestor(SELECTORS.PARENTWITHCHILDREN, true);\n\n        if (!categorynode.hasClass(CSS.HASCHILDREN)) {\n            // Nothing to do here - this category has no children.\n            return;\n        }\n\n        if (categorynode.hasClass(CSS.LOADED)) {\n            // We've already loaded this content so we just need to toggle the view of it.\n            run_expansion(categorynode);\n            return;\n        }\n\n        // We use Data attributes to store the category.\n        categoryid = categorynode.getData('categoryid');\n        depth = categorynode.getData('depth');\n\n        if (typeof categoryid === \"undefined\" || typeof depth === \"undefined\") {\n            return;\n        }\n\n        _toggle_generic_expansion({\n            parentnode: categorynode,\n            childnode: categorynode.one(SELECTORS.CONTENTNODE),\n            spinnerhandle: SELECTORS.CATEGORYSPINNERLOCATION,\n            spinner: SELECTORS.SPINNER,\n            data: {\n                sesskey: M.cfg.sesskey,\n                categoryid: categoryid,\n                depth: depth,\n                showcourses: categorynode.getData('showcourses'),\n                type: TYPE_CATEGORY\n            }\n        });\n    };\n\n    /**\n     * Wrapper function to handle toggling of generic types.\n     *\n     * @method _toggle_generic_expansion\n     * @private\n     * @param {Object} config\n     */\n    var _toggle_generic_expansion = function(config) {\n        var self = this;\n        // Using amd instead of Y.Promise just because there is no point\n        // learning new YUI techniques. And the YUI in this plugin may be\n        // replaced entirely with amd in future.\n        Str.get_string('loading', 'core')\n            .then(function(string) {\n                return Templates.renderPix('i/progressbar', 'core', string);\n            })\n            .then(function(html) {\n                var node = config.parentnode.one(config.spinnerhandle);\n                var spinnernode = $(html).addClass('progress-icon');\n                node.append(spinnernode);\n                return spinnernode;\n            })\n            .then(function(spinnernode) {\n                var years = {};\n                var periods = {};\n                var yearselect = $('#culcourse_listing_filter_year');\n                var periodselect = $('#culcourse_listing_filter_period');\n\n                if (yearselect) {\n                    $.each(yearselect.attr('options'), function(key, value) {\n                        years[value] = key;\n                    });\n                    config.data.years = JSON.stringify(years);\n                }\n\n                if (periodselect) {\n                    $.each(periodselect.attr('options'), function(key, value) {\n                        periods[value] = key;\n                    });\n                    config.data.periods = JSON.stringify(periods);\n                }\n\n                var args = {\n                        parentnode: config.parentnode,\n                        childnode: config.childnode,\n                        spinnernode: spinnernode\n                    };\n\n                $.ajax({\n                    url: URL,\n                    method: 'POST',\n                    data: config.data,\n                    context: self,\n                    success: function(response) {\n                        process_results(response, args);\n                    }\n                });\n\n            }).fail(Notification.exception);\n    };\n\n    /**\n     * Apply the animation on the supplied node.\n     *\n     * @method run_expansion\n     * @private\n     * @param {Node} categorynode The node to apply the animation to\n     */\n    var run_expansion = function(categorynode) {\n\n        Y.use('anim-node-plugin', function() {\n            var categorychildren = categorynode.one(SELECTORS.CONTENTNODE),\n                ancestor = categorynode.ancestor(SELECTORS.COURSECATEGORYTREE);\n\n            // Add our animation to the categorychildren.\n            add_animation(categorychildren);\n\n            // If we already have the class, remove it before showing otherwise we perform the\n            // animation whilst the node is hidden.\n            if (categorynode.hasClass(CSS.SECTIONCOLLAPSED)) {\n                // To avoid a jump effect, we need to set the height of the children to 0 here before removing\n                // the SECTIONCOLLAPSED class.\n                categorychildren.setStyle('height', '0');\n                categorynode.removeClass(CSS.SECTIONCOLLAPSED);\n                categorynode.setAttribute('aria-expanded', 'true');\n                categorychildren.fx.set('reverse', false);\n            } else {\n                categorychildren.fx.set('reverse', true);\n                categorychildren.fx.once('end', function(e, categorynode) {\n                    categorynode.addClass(CSS.SECTIONCOLLAPSED);\n                    categorynode.setAttribute('aria-expanded', 'false');\n                }, this, categorynode);\n            }\n\n            categorychildren.fx.once('end', function(e, categorychildren) {\n                // Remove the styles that the animation has set.\n                categorychildren.setStyles({\n                    height: '',\n                    opacity: ''\n                });\n\n                // To avoid memory gobbling, remove the animation. It will be added back if called again.\n                this.destroy();\n                update_collapsible_actions(ancestor);\n            }, categorychildren.fx, categorychildren);\n\n            // Now that everything has been set up, run the animation.\n            categorychildren.fx.run();\n        });\n    };\n\n    var collapse_expand_all = function(e) {\n        // The collapse/expand button has no actual target but we need to prevent it's default\n        // action to ensure we don't make the page reload/jump.\n        e.preventDefault();\n\n        if (e.currentTarget.hasClass(CSS.DISABLED)) {\n            // The collapse/expand is currently disabled.\n            return;\n        }\n\n        var ancestor = e.currentTarget.ancestor(SELECTORS.COURSECATEGORYTREE);\n        if (!ancestor) {\n            return;\n        }\n\n        var collapseall = ancestor.one(SELECTORS.COLLAPSEEXPAND);\n        if (collapseall.hasClass(CSS.COLLAPSEALL)) {\n            collapse_all(ancestor);\n        } else {\n            expand_all(ancestor);\n        }\n        update_collapsible_actions(ancestor);\n    };\n\n    var expand_all = function(ancestor) {\n        var finalexpansions = [];\n\n        ancestor.all(SELECTORS.CATEGORYWITHCOLLAPSEDLOADEDCHILDREN)\n            .each(function(c) {\n            if (c.ancestor(SELECTORS.CATEGORYWITHCOLLAPSEDLOADEDCHILDREN)) {\n                // Expand the hidden children first without animation.\n                c.removeClass(CSS.SECTIONCOLLAPSED);\n                c.all(SELECTORS.LOADEDTREES).removeClass(CSS.SECTIONCOLLAPSED);\n            } else {\n                finalexpansions.push(c);\n            }\n        }, this);\n\n        // Run the final expansion with animation on the visible items.\n        Y.all(finalexpansions).each(function(c) {\n            run_expansion(c);\n        }, this);\n\n    };\n\n    var collapse_all = function(ancestor) {\n        var finalcollapses = [];\n\n        ancestor.all(SELECTORS.CATEGORYWITHMAXIMISEDLOADEDCHILDREN)\n            .each(function(c) {\n            if (c.ancestor(SELECTORS.CATEGORYWITHMAXIMISEDLOADEDCHILDREN)) {\n                finalcollapses.push(c);\n            } else {\n                // Collapse the visible items first\n                run_expansion(c);\n            }\n        }, this);\n\n        // Run the final collapses now that the these are hidden hidden.\n        Y.all(finalcollapses).each(function(c) {\n            c.addClass(CSS.SECTIONCOLLAPSED);\n            c.all(SELECTORS.LOADEDTREES).addClass(CSS.SECTIONCOLLAPSED);\n        }, this);\n    };\n\n    var update_collapsible_actions = function(ancestor) {\n        if (!ancestor) {\n            // We will not have an ancestor when a course in the favoutites list is expanded\n            return;\n        }\n\n        var foundmaximisedchildren = false,\n        // Grab the anchor for the collapseexpand all link.\n        togglelink = ancestor.one(SELECTORS.COLLAPSEEXPAND);\n\n        if (!togglelink) {\n            // We should always have a togglelink but ensure.\n            return;\n        }\n\n        // Search for any visibly expanded children.\n        ancestor.all(SELECTORS.CATEGORYWITHMAXIMISEDLOADEDCHILDREN).each(function(n) {\n            // If we can find any collapsed ancestors, skip.\n            if (n.ancestor(SELECTORS.CATEGORYWITHCOLLAPSEDLOADEDCHILDREN)) {\n                return false;\n            }\n            foundmaximisedchildren = true;\n            return true;\n        }, this);\n\n        togglelink.removeClass(CSS.HIDE);\n\n        if (foundmaximisedchildren) {\n            // At least one maximised child found. Show the collapseall.\n            togglelink.setHTML(M.util.get_string('collapseall', 'moodle'))\n                .addClass(CSS.COLLAPSEALL)\n                .removeClass(CSS.DISABLED);\n        } else {\n            // No maximised children found but there are collapsed children. Show the expandall.\n            togglelink.setHTML(M.util.get_string('expandall', 'moodle'))\n                .removeClass(CSS.COLLAPSEALL)\n                .removeClass(CSS.DISABLED);\n        }\n    };\n\n    /**\n     * Process the data returned by $.ajax.\n     * This includes appending it to the relevant part of the DOM, and applying our animation.\n     *\n     * @method process_results\n     * @private\n     * @param {Object} data The Response returned by $.ajax\n     * @param {Object} args The additional arguments provided by $.ajax\n     */\n    var process_results = function(data, args) {\n        var newnode;\n\n        try {\n            if (data.error) {\n                return new M.core.ajaxException(data);\n            }\n        } catch (e) {\n            return new M.core.exception(e);\n        }\n\n        // Insert the returned data into a new Node.\n        newnode = Y.Node.create(data.content);\n\n        // Append to the existing child location.\n        args.childnode.appendChild(newnode);\n\n        // Now that we have content, we can swap the classes on the toggled container.\n        args.parentnode\n            .addClass(CSS.LOADED)\n            .removeClass(CSS.NOTLOADED);\n\n        // Toggle the open/close status of the node now that it's content has been loaded.\n        run_expansion(args.parentnode);\n\n        // Update the filters.\n        if (data.filterform) {\n            var filterform = Y.one('.filter');\n            filterform.setHTML(data.filterform);\n        }\n\n        // Remove the spinner now that we've started to show the content.\n        if (args.spinnernode) {\n            args.spinnernode.hide();\n        }\n    };\n\n    /**\n     * Add our animation to the Node.\n     *\n     * @method add_animation\n     * @private\n     * @param {Node} childnode\n     */\n    var add_animation = function(childnode) {\n        if (typeof childnode.fx !== \"undefined\") {\n            // The animation has already been plugged to this node.\n            return childnode;\n        }\n\n        childnode.plug(Y.Plugin.NodeFX, {\n            from: {\n                height: 0,\n                opacity: 0\n            },\n            to: {\n                // This sets a dynamic height in case the node content changes.\n                height: function(node) {\n                    // Get expanded height (offsetHeight may be zero).\n                    return node.get('scrollHeight');\n                },\n                opacity: 1\n            },\n            duration: 0.2\n        });\n\n        return childnode;\n    };\n\n    return {\n        /**\n         * Set up the category expander.\n         *\n         * No arguments are required.\n         *\n         * @method init\n         */\n        initializer: function(params) {\n            this.BLOCKCONFIG = params.config;\n            var doc = Y.one(Y.config.doc);\n            doc.delegate('click', function(e) {e.preventDefault();}, SELECTORS.CATEGORYCHILDLINK, this);\n            doc.delegate('click', toggle_category_expansion, SELECTORS.CATEGORYLISTENLINK, this);\n            doc.delegate('click', toggle_coursebox_expansion, SELECTORS.COURSEBOXLISTENLINK, this);\n            doc.delegate('click', collapse_expand_all, SELECTORS.COLLAPSEEXPAND, this);\n\n            // Only set up they keyboard listeners when tab is first pressed - it\n            // may never happen and modifying the DOM on a large number of nodes\n            // can be very expensive.\n            doc.once('key', setup_keyboard_listeners, 'tab', this);\n        }\n    };\n});"],"file":"category.min.js"}