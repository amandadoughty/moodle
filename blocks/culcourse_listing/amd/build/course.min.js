define ("block_culcourse_listing/course",["jquery","core/ajax","core/templates","core/notification","core/str","core/yui","core/pubsub","core_course/events","block_culcourse_listing/favourite","block_myoverview/main","block_starredcourses/main"],function(a,b,c,d,e,f,g,h,i,j,k){var l={COURSEBOXLIST:".block_culcourse_listing .course_category_tree",COURSEBOXLISTCOURSEBOX:".course_category_tree .culcoursebox",FAVOURITELIST:".favourite_list",FAVOURITECOURSEBOX:".favourite_list .culcoursebox",FAVOURITELINK:".favouritelink i",FAVOURITEICON:".favouritelink i",FAVOURITECLEARBUTTON:".block_culcourse_listing #clearfavourites",FAVOURITEREORDERBUTTON:".block_culcourse_listing #reorderfavourites",FAVOURITEALERT:".block_culcourse_listing .favourite_list span"},m=M.cfg.wwwroot+"/blocks/culcourse_listing/favourite_ajax.php",n=M.cfg.wwwroot+"/blocks/culcourse_listing/favouriteapi_ajax.php";window.editrunning=!1;var o=function(b){b.preventDefault();if(window.editrunning){return}window.editrunning=!0;var c=b.target.get("parentNode"),e=c.get("href").split("?"),g=e[1];f.use("querystring-parse","event-custom",function(){var b=f.QueryString.parse(g);a.ajax({url:m,method:"POST",data:b,context:self,success:function success(a){if(a.error){d.alert(null,a.error)}else{p(a,b)}},error:function error(){},complete:function complete(){window.editrunning=!1;f.fire("culcourse-listing:update-favourites");var b=a(".block_myoverview .block-myoverview");a.each(b,function(a,b){j.init(b)});var b=a(".block_starredcourses .block-starredcourses");a.each(b,function(a,b){k.init(b)})}}).fail(d.exception)})},p=function(b,g){c.render("block_culcourse_listing/coursebox",b).then(function(b){var c=a(b),h=a(b);if("add"==g.action){var j=a(l.COURSEBOXLIST+" [data-courseid=\""+g.cid+"\"]");if(j){j.replaceWith(c)}h.css("opacity",0);a(l.FAVOURITELIST).append(h);var k=f.one(l.FAVOURITELIST+" [data-courseid=\""+g.cid+"\"]");i.initializer({node:k});if(0<a(l.FAVOURITECOURSEBOX).length){a(l.FAVOURITECLEARBUTTON).show().css("display","inline-block");a(l.FAVOURITEREORDERBUTTON).show().css("display","inline-block");a(l.FAVOURITEALERT).text("")}h.animate({opacity:1},1e3,function(){})}else if("delete"==g.action){e.get_string("nofavourites","block_culcourse_listing").then(function(b){var d=a(l.COURSEBOXLIST+" [data-courseid=\""+g.cid+"\"]"),e=a(l.FAVOURITELIST+" [data-courseid=\""+g.cid+"\"]");e.animate({opacity:0},1e3,function(){this.remove();if(0==a(l.FAVOURITECOURSEBOX).length){a(l.FAVOURITECLEARBUTTON).hide();a(l.FAVOURITEREORDERBUTTON).hide();a(l.FAVOURITEALERT).html("<span>"+b+"</span>")}});if(d){d.replaceWith(c)}}).catch(d.exception)}}).fail(d.exception)},q=function(b,c){a.ajax({url:n,method:"POST",data:{sesskey:M.cfg.sesskey,cid:b,action:c},context:self,success:function success(a){if(a.data){p(a.data,a);return!0}else{return!1}},error:function error(a){d.addNotification({message:a.error,type:"error"})},complete:function complete(){f.fire("culcourse-listing:update-favourites")}}).fail(d.exception)};return{initializer:function initializer(){var a=f.one(f.config.doc);a.delegate("click",o,l.FAVOURITELINK,this);f.publish("culcourse-listing:update-favourites",{broadcast:2});g.subscribe(h.favourited,function(a){q(a,"add")});g.subscribe(h.unfavorited,function(a){q(a,"delete")})}}});
//# sourceMappingURL=course.min.js.map
