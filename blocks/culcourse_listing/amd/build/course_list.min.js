define(["jquery","core/ajax","core/templates","core/notification","core/str","core/url","core/yui","core/modal_factory","core/modal_events","core/key_codes","block_culcourse_listing/course"],function(a,b,c,d,e,f,g,h,i,j,k){var l={HIDE:"hide",FILTERON:"filter-on",FILTEROFF:"filter-off"},m={CATEGORYNOTMANAGED:".culcategory:not(.manage)",COURSEBOXLIST:".block_culcourse_listing  .course_category_tree",COURSEBOX:".culcoursebox",COURSEBOXLISTCOURSEBOX:".course_category_tree .culcoursebox",FAVOURITELIST:".favourite_list",FAVOURITECOURSEBOX:".favourite_list .culcoursebox",FILTERLIST:"#culcourse_listing_filter .select",FILTERALERT:".block_culcourse_listing .course_category_tree .divalert"},n=function(){k.initializer()},o=function(a,b){var c=g.all(m.FILTERLIST),d=c.get("value")[0],e=c.get("value")[1],f=M.util.get_string("all","block_culcourse_listing");d=d!=f&&0!=b.filterbyyear&&d,e=e!=f&&0!=b.filterbyperiod&&e,M.util.set_user_preference(a.target.get("id"),a.target.get("value"));var h=g.one(m.COURSEBOXLIST);if(0==d&&0==e)h.removeClass(l.FILTERON),h.addClass(l.FILTEROFF);else{h.removeClass(l.FILTEROFF),h.addClass(l.FILTERON);var i=g.one(m.FILTERALERT),j="";0!=d&&(j=d),0!=d&&0!=e&&(j+=M.util.get_string("and","block_culcourse_listing")),0!=e&&(j+=M.util.get_string(e,"block_culcourse_listing")),j=M.util.get_string("divalert","block_culcourse_listing",j),i.set("innerHTML",j)}var k=g.all(m.COURSEBOXLISTCOURSEBOX),n=g.all(m.CATEGORYNOTMANAGED);k.removeClass(l.HIDE),n.removeClass(l.HIDE),k.setStyle("display","block"),n.setStyle("display","none");var o=function(a){var b=g.Array(a.getData("year")),c=g.Array(a.getData("period"));d&&d!=b&&a.setStyle("display","none"),e&&e!=c&&a.setStyle("display","none")},p=function(a){var b=g.Array(a.getData("year")),c=g.Array(a.getData("period"));d&&d!=b&&a.setStyle("display","none"),e&&e!=c&&a.setStyle("display","none")};"regex"==b.filtertype?k.each(o):"date"==b.filtertype&&k.each(p);var q=function(a){var b=a.all(m.COURSEBOX);b.each(function(b){"none"!==b.getStyle("display")&&a.setStyle("display","block")})};n.each(q)};return{initializer:function(a){n();var b=g.one(g.config.doc);b.delegate("change",o,m.FILTERLIST,this,a)}}});