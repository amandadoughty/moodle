{"version":3,"sources":["../src/course_list.js"],"names":["define","$","ajax","templates","notification","str","url","Y","ModalFactory","ModalEvents","KeyCodes","Course","CSS","HIDE","FILTERON","FILTEROFF","SELECTORS","CATEGORYNOTMANAGED","COURSEBOXLIST","COURSEBOX","COURSEBOXLISTCOURSEBOX","FAVOURITELIST","FAVOURITECOURSEBOX","FILTERLIST","FILTERALERT","setupcourses","initializer","filtercourses","e","config","selectlist","all","filteryear","get","filterperiod","M","util","get_string","filterbyyear","filterbyperiod","set_user_preference","target","container","one","removeClass","addClass","heading","filterstring","set","courselist","categorylist","setStyle","filterbyregex","node","courseyear","Array","getData","courseperiod","filterbydate","filtertype","each","filtercategory","children","child","getStyle","doc","delegate"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * A javascript module to ...\n *\n * @package    block_culcourse_listing\n * @copyright  2019 Amanda Doughty\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/ajax', 'core/templates', 'core/notification', 'core/str', 'core/url', 'core/yui',\n        'core/modal_factory', 'core/modal_events', 'core/key_codes', 'block_culcourse_listing/course'],\n    function($, ajax, templates, notification, str, url, Y, ModalFactory, ModalEvents, KeyCodes, Course) {\n\n    var CSS = {\n            HIDE: 'hide',\n            FILTERON: 'filter-on',\n            FILTEROFF: 'filter-off',\n        };\n    var SELECTORS = {\n        CATEGORYNOTMANAGED: '.culcategory:not(.manage)',\n        COURSEBOXLIST: '.block_culcourse_listing  .course_category_tree',\n        COURSEBOX: '.culcoursebox',\n        COURSEBOXLISTCOURSEBOX: '.course_category_tree .culcoursebox',\n        FAVOURITELIST: '.favourite_list',\n        FAVOURITECOURSEBOX: '.favourite_list .culcoursebox',\n        FILTERLIST: '#culcourse_listing_filter .select',\n        FILTERALERT: '.block_culcourse_listing .course_category_tree .divalert',\n    };\n\n    var setupcourses = function() {\n        Course.initializer();\n    };\n\n    var filtercourses = function(e, config) {\n        var selectlist = Y.all(SELECTORS.FILTERLIST);\n        var filteryear = selectlist.get('value')[0];\n        var filterperiod = selectlist.get('value')[1];\n        var all = M.util.get_string('all', 'block_culcourse_listing');\n        filteryear = (filteryear == all || config.filterbyyear == 0) ? false : filteryear;\n        filterperiod = (filterperiod == all || config.filterbyperiod == 0) ? false : filterperiod;\n        // Save the choice.\n        M.util.set_user_preference(e.target.get('id'), e.target.get('value'));\n        // Set the class for the course category list.\n        var container = Y.one(SELECTORS.COURSEBOXLIST);\n\n        if (filteryear == false && filterperiod == false ) {\n            container.removeClass(CSS.FILTERON);\n            container.addClass(CSS.FILTEROFF);\n        } else {\n            container.removeClass(CSS.FILTEROFF);\n            container.addClass(CSS.FILTERON);\n            // Set the text for the heading.\n            var heading = Y.one(SELECTORS.FILTERALERT);\n            var filterstring = '';\n\n            if (filteryear != false) {\n                filterstring = filteryear;\n            }\n            if (filteryear != false && filterperiod != false) {\n                filterstring = filterstring + M.util.get_string('and', 'block_culcourse_listing');\n            }\n            if (filterperiod != false) {\n                filterstring = filterstring + M.util.get_string(filterperiod, 'block_culcourse_listing');\n            }\n\n            filterstring = M.util.get_string('divalert', 'block_culcourse_listing', filterstring);\n            heading.set('innerHTML', filterstring);\n        }\n\n        // Hide all the courses and categories.\n        var courselist = Y.all(SELECTORS.COURSEBOXLISTCOURSEBOX);\n        var categorylist = Y.all(SELECTORS.CATEGORYNOTMANAGED);\n        courselist.removeClass(CSS.HIDE);\n        categorylist.removeClass(CSS.HIDE);\n        courselist.setStyle('display', 'block');\n        categorylist.setStyle('display', 'none');\n\n        // Hide the filtered out courses.\n        var filterbyregex = function(node){\n            var courseyear = Y.Array(node.getData('year'));\n            var courseperiod = Y.Array(node.getData('period'));\n\n            if (filteryear && filteryear != courseyear) {\n                node.setStyle('display', 'none');\n            }\n            if (filterperiod && filterperiod != courseperiod) {\n                node.setStyle('display', 'none');\n            }\n        };\n\n        // TODO Hide the filtered out courses.\n        var filterbydate = function(node){\n            var courseyear = Y.Array(node.getData('year'));\n            var courseperiod = Y.Array(node.getData('period'));\n\n            if (filteryear && filteryear != courseyear) {\n                node.setStyle('display', 'none');\n            }\n            if (filterperiod && filterperiod != courseperiod) {\n                node.setStyle('display', 'none');\n            }\n        };\n\n        if (config.filtertype == 'regex') {\n            courselist.each(filterbyregex);\n        } else if (config.filtertype == 'date') {\n            courselist.each(filterbydate);\n        }\n\n        // Hide categories that have no unhidden children.\n        var filtercategory = function(node){\n            var children = node.all(SELECTORS.COURSEBOX);\n            children.each(function(child){\n                if (child.getStyle('display') !== 'none') {\n                    node.setStyle('display', 'block');\n                }\n            });\n        };\n\n        categorylist.each(filtercategory);\n    };\n\n    return {\n        initializer: function(config) {\n            setupcourses();\n            var doc = Y.one(Y.config.doc);\n            doc.delegate('change', filtercourses, SELECTORS.FILTERLIST, this, config);\n        }\n    };\n});\n"],"file":"course_list.min.js"}