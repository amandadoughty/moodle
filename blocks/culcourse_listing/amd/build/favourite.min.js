define(["jquery","core/ajax","core/templates","core/notification","core/str","core/url","core/yui"],function(a,b,c,d,e,f,g){var h={BLOCK:"block_culcourse_listing",COURSEBOX:"culcoursebox"},i={COURSEBOX:".culcoursebox",FAVOURITELIST:".favourite_list",FAVOURITECOURSEBOX:".favourite_list .culcoursebox",FAVOURITEMOVEWITHOUTJS:".moveicons",FAVOURITEMOVE:".favourite_list .move",COURSEBOXLINK:".info"},j=M.cfg.wwwroot+"/blocks/culcourse_listing/move_ajax.php",k=function(a){if("object"!=typeof a)return null;var b=[];for(var c in a){c=encodeURIComponent(c);var d=a[c];if(a[c]instanceof Array)for(var e in d)b.push(c+"[]="+encodeURIComponent(d[e]));else b.push(c+"="+encodeURIComponent(d))}return b.join("&")},l=function(a){var b=M.util.get_string("move","block_culcourse_listing"),c=g.Node.create('<div class="move"></div>'),d=g.Node.create('<img src="'+M.util.image_url("i/move_2d","moodle")+'" alt="'+b+'" title="'+b+'" class="cursor"/>');c.append(d),a.node.one(i.FAVOURITEMOVEWITHOUTJS)?a.node.one(i.FAVOURITEMOVEWITHOUTJS).replace(c):a.node.one(i.COURSEBOXLINK).prepend(c)},m=function(a){g.use("base","dd-constrain","dd-proxy","dd-drop","dd-delegate","dd-plugin",function(){l(a);var b=!1,c=0,d=new g.DD.Drag({node:a.node,target:!0}).plug(g.Plugin.DDProxy,{moveOnEnd:!1,cloneNode:!0}).plug(g.Plugin.DDConstrained,{constrain2node:i.FAVOURITELIST});d.addHandle(i.FAVOURITEMOVE),g.DD.DDM.on("drag:start",function(a){var b=a.target;b.get("node").setStyle("opacity",".25"),b.get("dragNode").addClass(h.BLOCK),b.get("dragNode").set("innerHTML",b.get("node").get("innerHTML")),b.get("dragNode").setStyles({opacity:".5",borderColor:b.get("node").getStyle("borderColor"),backgroundColor:b.get("node").getStyle("backgroundColor")})}),g.DD.DDM.on("drag:end",function(a){var b=a.target;b.get("node").setStyles({visibility:"",opacity:"1"}),n()}),g.DD.DDM.on("drag:drag",function(a){var d=a.target.lastXY[1];b=d<c,c=d}),g.DD.DDM.on("drop:over",function(a){var c=a.drag.get("node"),d=a.drop.get("node");d.hasClass(h.COURSEBOX)&&(b||(d=d.get("nextSibling")),a.drop.get("node").get("parentNode").insertBefore(c,d),a.drop.sizeShim())}),g.DD.DDM.on("drag:drophit",function(a){var b=a.drop.get("node"),c=a.drag.get("node");b.hasClass(h.COURSEBOX)||b.contains(c)||b.appendChild(c)})})},n=function(){var a=g.all(i.FAVOURITECOURSEBOX).getData("courseid"),b={sesskey:M.cfg.sesskey,sortorder:a};g.io(j,{method:"POST",data:k(b),context:this,on:{end:function(){var b=a;g.fire("culcourse-listing:update-favourites",{favourites:b})}}})};return{initializer:function(a){m(a)}}});