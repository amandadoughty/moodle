{"version":3,"sources":["../src/favourite.js"],"names":["define","$","ajax","templates","notification","str","url","Y","CSS","BLOCK","COURSEBOX","SELECTORS","FAVOURITELIST","FAVOURITECOURSEBOX","FAVOURITEMOVEWITHOUTJS","FAVOURITEMOVE","COURSEBOXLINK","URL","M","cfg","wwwroot","build_querystring","obj","list","k","encodeURIComponent","value","Array","i","push","join","addmoveicon","params","move","util","get_string","newdiv","Node","create","icon","image_url","append","node","one","replace","prepend","adddragdrop","use","goingUp","lastY","d","DD","Drag","target","plug","Plugin","DDProxy","moveOnEnd","cloneNode","DDConstrained","constrain2node","addHandle","DDM","on","e","drag","get","setStyle","addClass","set","setStyles","opacity","borderColor","getStyle","backgroundColor","visibility","savemove","y","lastXY","drop","hasClass","insertBefore","sizeShim","contains","appendChild","sortorder","all","getData","sesskey","io","method","data","context","end","fire","favourites","initializer"],"mappings":"yQAuBAA,OAAM,qCAAC,CAAC,QAAD,CAAW,WAAX,CAAwB,gBAAxB,CAA0C,mBAA1C,CAA+D,UAA/D,CAA2E,UAA3E,CAAuF,UAAvF,CAAD,CACF,SAASC,CAAT,CAAYC,CAAZ,CAAkBC,CAAlB,CAA6BC,CAA7B,CAA2CC,CAA3C,CAAgDC,CAAhD,CAAqDC,CAArD,CAAwD,IAEpDC,CAAAA,CAAG,CAAG,CACFC,KAAK,CAAE,yBADL,CAEFC,SAAS,CAAE,cAFT,CAF8C,CAMpDC,CAAS,CAAG,CACZD,SAAS,CAAE,eADC,CAEZE,aAAa,CAAE,iBAFH,CAGZC,kBAAkB,CAAE,+BAHR,CAIZC,sBAAsB,CAAE,YAJZ,CAKZC,aAAa,CAAE,uBALH,CAMZC,aAAa,CAAE,OANH,CANwC,CAcpDC,CAAG,CAAGC,CAAC,CAACC,GAAF,CAAMC,OAAN,CAAgB,yCAd8B,CAgBpDC,CAAiB,CAAG,SAAUC,CAAV,CAAe,CACnC,GAAmB,QAAf,WAAOA,CAAP,CAAJ,CAA6B,CACzB,MAAO,KACV,CAED,GAAIC,CAAAA,CAAI,CAAG,EAAX,CAEA,IAAI,GAAIC,CAAAA,CAAR,GAAaF,CAAAA,CAAb,CAAkB,CACdE,CAAC,CAAGC,kBAAkB,CAACD,CAAD,CAAtB,CACA,GAAIE,CAAAA,CAAK,CAAGJ,CAAG,CAACE,CAAD,CAAf,CAEA,GAAGF,CAAG,CAACE,CAAD,CAAH,UAAkBG,CAAAA,KAArB,CAA4B,CACxB,IAAI,GAAIC,CAAAA,CAAR,GAAaF,CAAAA,CAAb,CAAoB,CAChBH,CAAI,CAACM,IAAL,CAAUL,CAAC,CAAG,KAAJ,CAAYC,kBAAkB,CAACC,CAAK,CAACE,CAAD,CAAN,CAAxC,CACH,CACJ,CAJD,IAIO,CACHL,CAAI,CAACM,IAAL,CAAUL,CAAC,CAAG,GAAJ,CAAUC,kBAAkB,CAACC,CAAD,CAAtC,CACH,CACJ,CAED,MAAOH,CAAAA,CAAI,CAACO,IAAL,CAAU,GAAV,CACV,CArCuD,CAuCpDC,CAAW,CAAG,SAASC,CAAT,CAAiB,IAE3BC,CAAAA,CAAI,CAAGf,CAAC,CAACgB,IAAF,CAAOC,UAAP,CAAkB,MAAlB,CAA0B,yBAA1B,CAFoB,CAG3BC,CAAM,CAAG7B,CAAC,CAAC8B,IAAF,CAAOC,MAAP,CAAc,4BAAd,CAHkB,CAI3BC,CAAI,CAAGhC,CAAC,CAAC8B,IAAF,CAAOC,MAAP,CACP,cAAepB,CAAC,CAACgB,IAAF,CAAOM,SAAP,CAAiB,WAAjB,CAA8B,QAA9B,CAAf,CACA,WADA,CACYP,CADZ,CAEA,aAFA,CAEcA,CAFd,CAGA,uBAJO,CAJoB,CAU/BG,CAAM,CAACK,MAAP,CAAcF,CAAd,EAEA,GAAIP,CAAM,CAACU,IAAP,CAAYC,GAAZ,CAAgBhC,CAAS,CAACG,sBAA1B,CAAJ,CAAuD,CACnDkB,CAAM,CAACU,IAAP,CAAYC,GAAZ,CAAgBhC,CAAS,CAACG,sBAA1B,EAAkD8B,OAAlD,CAA0DR,CAA1D,CACH,CAFD,IAEO,CACHJ,CAAM,CAACU,IAAP,CAAYC,GAAZ,CAAgBhC,CAAS,CAACK,aAA1B,EAAyC6B,OAAzC,CAAiDT,CAAjD,CACH,CACJ,CAxDuD,CA0DpDU,CAAW,CAAG,SAASd,CAAT,CAAiB,CAC/BzB,CAAC,CAACwC,GAAF,CAAM,MAAN,CAAc,cAAd,CAA8B,UAA9B,CAA0C,SAA1C,CAAqD,aAArD,CAAoE,WAApE,CAAiF,UAAW,CACxFhB,CAAW,CAACC,CAAD,CAAX,CADwF,GAGpFgB,CAAAA,CAAO,GAH6E,CAGnEC,CAAK,CAAG,CAH2D,CAKpFC,CAAC,CAAG,GAAI3C,CAAAA,CAAC,CAAC4C,EAAF,CAAKC,IAAT,CAAc,CACdV,IAAI,CAAEV,CAAM,CAACU,IADC,CAEdW,MAAM,GAFQ,CAAd,EAGDC,IAHC,CAGI/C,CAAC,CAACgD,MAAF,CAASC,OAHb,CAGsB,CACtBC,SAAS,GADa,CAEtBC,SAAS,GAFa,CAHtB,EAMDJ,IANC,CAMI/C,CAAC,CAACgD,MAAF,CAASI,aANb,CAM4B,CAC5BC,cAAc,CAAEjD,CAAS,CAACC,aADE,CAN5B,CALgF,CAcpFsC,CAAC,CAACW,SAAF,CAAYlD,CAAS,CAACI,aAAtB,EAEJR,CAAC,CAAC4C,EAAF,CAAKW,GAAL,CAASC,EAAT,CAAY,YAAZ,CAA0B,SAASC,CAAT,CAAY,CAElC,GAAIC,CAAAA,CAAI,CAAGD,CAAC,CAACX,MAAb,CAEAY,CAAI,CAACC,GAAL,CAAS,MAAT,EAAiBC,QAAjB,CAA0B,SAA1B,CAAqC,KAArC,EACAF,CAAI,CAACC,GAAL,CAAS,UAAT,EAAqBE,QAArB,CAA8B5D,CAAG,CAACC,KAAlC,EACAwD,CAAI,CAACC,GAAL,CAAS,UAAT,EAAqBG,GAArB,CAAyB,WAAzB,CAAsCJ,CAAI,CAACC,GAAL,CAAS,MAAT,EAAiBA,GAAjB,CAAqB,WAArB,CAAtC,EACAD,CAAI,CAACC,GAAL,CAAS,UAAT,EAAqBI,SAArB,CAA+B,CAC3BC,OAAO,CAAE,IADkB,CAE3BC,WAAW,CAAEP,CAAI,CAACC,GAAL,CAAS,MAAT,EAAiBO,QAAjB,CAA0B,aAA1B,CAFc,CAG3BC,eAAe,CAAET,CAAI,CAACC,GAAL,CAAS,MAAT,EAAiBO,QAAjB,CAA0B,iBAA1B,CAHU,CAA/B,CAKH,CAZD,EAcAlE,CAAC,CAAC4C,EAAF,CAAKW,GAAL,CAASC,EAAT,CAAY,UAAZ,CAAwB,SAASC,CAAT,CAAY,CAChC,GAAIC,CAAAA,CAAI,CAAGD,CAAC,CAACX,MAAb,CAEAY,CAAI,CAACC,GAAL,CAAS,MAAT,EAAiBI,SAAjB,CAA2B,CACvBK,UAAU,CAAE,EADW,CAEvBJ,OAAO,CAAE,GAFc,CAA3B,EAIAK,CAAQ,EACX,CARD,EAUArE,CAAC,CAAC4C,EAAF,CAAKW,GAAL,CAASC,EAAT,CAAY,WAAZ,CAAyB,SAASC,CAAT,CAAY,CAEjC,GAAIa,CAAAA,CAAC,CAAGb,CAAC,CAACX,MAAF,CAASyB,MAAT,CAAgB,CAAhB,CAAR,CAGA,GAAID,CAAC,CAAG5B,CAAR,CAAe,CAEXD,CAAO,GACV,CAHD,IAGO,CAEHA,CAAO,GACV,CAGDC,CAAK,CAAG4B,CACX,CAfD,EAiBAtE,CAAC,CAAC4C,EAAF,CAAKW,GAAL,CAASC,EAAT,CAAY,WAAZ,CAAyB,SAASC,CAAT,CAAY,CAEjC,GAAIC,CAAAA,CAAI,CAAGD,CAAC,CAACC,IAAF,CAAOC,GAAP,CAAW,MAAX,CAAX,CACIa,CAAI,CAAGf,CAAC,CAACe,IAAF,CAAOb,GAAP,CAAW,MAAX,CADX,CAIA,GAAIa,CAAI,CAACC,QAAL,CAAcxE,CAAG,CAACE,SAAlB,CAAJ,CAAkC,CAE9B,GAAI,CAACsC,CAAL,CAAc,CACV+B,CAAI,CAAGA,CAAI,CAACb,GAAL,CAAS,aAAT,CACV,CAEDF,CAAC,CAACe,IAAF,CAAOb,GAAP,CAAW,MAAX,EAAmBA,GAAnB,CAAuB,YAAvB,EAAqCe,YAArC,CAAkDhB,CAAlD,CAAwDc,CAAxD,EAEAf,CAAC,CAACe,IAAF,CAAOG,QAAP,EACH,CACJ,CAhBD,EAkBA3E,CAAC,CAAC4C,EAAF,CAAKW,GAAL,CAASC,EAAT,CAAY,cAAZ,CAA4B,SAASC,CAAT,CAAY,CACpC,GAAIe,CAAAA,CAAI,CAAGf,CAAC,CAACe,IAAF,CAAOb,GAAP,CAAW,MAAX,CAAX,CACID,CAAI,CAAGD,CAAC,CAACC,IAAF,CAAOC,GAAP,CAAW,MAAX,CADX,CAIA,GAAI,CAACa,CAAI,CAACC,QAAL,CAAcxE,CAAG,CAACE,SAAlB,CAAL,CAAmC,CAC/B,GAAI,CAACqE,CAAI,CAACI,QAAL,CAAclB,CAAd,CAAL,CAA0B,CACtBc,CAAI,CAACK,WAAL,CAAiBnB,CAAjB,CACH,CACJ,CACJ,CAVD,CAWH,CAtFD,CAuFH,CAlJuD,CAoJpDW,CAAQ,CAAG,UAAW,IAClBS,CAAAA,CAAS,CAAG9E,CAAC,CAAC+E,GAAF,CAAM3E,CAAS,CAACE,kBAAhB,EAAoC0E,OAApC,CAA4C,UAA5C,CADM,CAGlBvD,CAAM,CAAG,CACTwD,OAAO,CAAGtE,CAAC,CAACC,GAAF,CAAMqE,OADP,CAETH,SAAS,CAAGA,CAFH,CAHS,CAQtB9E,CAAC,CAACkF,EAAF,CAAKxE,CAAL,CAAU,CACNyE,MAAM,CAAE,MADF,CAENC,IAAI,CAAEtE,CAAiB,CAACW,CAAD,CAFjB,CAGN4D,OAAO,CAAE,IAHH,CAIN7B,EAAE,CAAE,CACA8B,GAAG,CAAE,cAAW,CAEZtF,CAAC,CAACuF,IAAF,CAAO,qCAAP,CAA8C,CAC1CC,UAAU,CAFDV,CACiC,CAA9C,CAGH,CAND,CAJE,CAAV,CAaH,CAzKuD,CA2KxD,MAAO,CACHW,WAAW,CAAE,qBAAShE,CAAT,CAAiB,CAC1Bc,CAAW,CAACd,CAAD,CACd,CAHE,CAKV,CAjLK,CAAN","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * A javascript module to ...\n *\n * @package    block_culcourse_listing\n * @copyright  2019 Amanda Doughty\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/ajax', 'core/templates', 'core/notification', 'core/str', 'core/url', 'core/yui'],\n    function($, ajax, templates, notification, str, url, Y) {\n\n    var CSS = {\n            BLOCK: 'block_culcourse_listing',\n            COURSEBOX: 'culcoursebox',\n        };\n    var SELECTORS = {\n        COURSEBOX: '.culcoursebox',\n        FAVOURITELIST: '.favourite_list',\n        FAVOURITECOURSEBOX: '.favourite_list .culcoursebox',\n        FAVOURITEMOVEWITHOUTJS: '.moveicons',\n        FAVOURITEMOVE: '.favourite_list .move',\n        COURSEBOXLINK: '.info',\n    };\n    var URL = M.cfg.wwwroot + '/blocks/culcourse_listing/move_ajax.php';\n\n    var build_querystring = function (obj) {\n        if (typeof obj !== 'object') {\n            return null;\n        }\n\n        var list = [];\n\n        for(var k in obj) {\n            k = encodeURIComponent(k);\n            var value = obj[k];\n\n            if(obj[k] instanceof Array) {\n                for(var i in value) {\n                    list.push(k + '[]=' + encodeURIComponent(value[i]));\n                }\n            } else {\n                list.push(k + '=' + encodeURIComponent(value));\n            }\n        }\n\n        return list.join('&');\n    };\n\n    var addmoveicon = function(params) {\n        // Replace the non-JS links.\n        var move = M.util.get_string('move', 'block_culcourse_listing');\n        var newdiv = Y.Node.create('<div class=\"move\"></div>');\n        var icon = Y.Node.create(\n            '<img src=\"' + M.util.image_url('i/move_2d', 'moodle') +\n            '\" alt=\"' + move +\n            '\" title=\"' + move +\n            '\" class=\"cursor\"/>'\n            );\n        newdiv.append(icon);\n\n        if (params.node.one(SELECTORS.FAVOURITEMOVEWITHOUTJS)) {\n            params.node.one(SELECTORS.FAVOURITEMOVEWITHOUTJS).replace(newdiv);\n        } else {\n            params.node.one(SELECTORS.COURSEBOXLINK).prepend(newdiv);\n        }\n    };\n\n    var adddragdrop = function(params) {\n        Y.use('base', 'dd-constrain', 'dd-proxy', 'dd-drop', 'dd-delegate', 'dd-plugin', function() {\n            addmoveicon(params);\n            // Static Vars.\n            var goingUp = false, lastY = 0;\n\n            var d = new Y.DD.Drag({\n                    node: params.node,\n                    target: true\n                }).plug(Y.Plugin.DDProxy, {\n                    moveOnEnd: false,\n                    cloneNode: true\n                }).plug(Y.Plugin.DDConstrained, {\n                    constrain2node: SELECTORS.FAVOURITELIST\n                });\n                d.addHandle(SELECTORS.FAVOURITEMOVE);\n\n            Y.DD.DDM.on('drag:start', function(e) {\n                // Get our drag object.\n                var drag = e.target;\n                // Set some styles here.\n                drag.get('node').setStyle('opacity', '.25');\n                drag.get('dragNode').addClass(CSS.BLOCK);\n                drag.get('dragNode').set('innerHTML', drag.get('node').get('innerHTML'));\n                drag.get('dragNode').setStyles({\n                    opacity: '.5',\n                    borderColor: drag.get('node').getStyle('borderColor'),\n                    backgroundColor: drag.get('node').getStyle('backgroundColor')\n                });\n            });\n\n            Y.DD.DDM.on('drag:end', function(e) {\n                var drag = e.target;\n                // Put our styles back.\n                drag.get('node').setStyles({\n                    visibility: '',\n                    opacity: '1'\n                });\n                savemove();\n            });\n\n            Y.DD.DDM.on('drag:drag', function(e) {\n                // Get the last y point.\n                var y = e.target.lastXY[1];\n\n                // Is it greater than the lastY var?\n                if (y < lastY) {\n                    // We are going up.\n                    goingUp = true;\n                } else {\n                    // We are going down.\n                    goingUp = false;\n                }\n\n                // Cache for next check.\n                lastY = y;\n            });\n\n            Y.DD.DDM.on('drop:over', function(e) {\n                // Get a reference to our drag and drop nodes.\n                var drag = e.drag.get('node'),\n                    drop = e.drop.get('node');\n\n                // Are we dropping on a li node?\n                if (drop.hasClass(CSS.COURSEBOX)) {\n                    // Are we not going up?\n                    if (!goingUp) {\n                        drop = drop.get('nextSibling');\n                    }\n                    // Add the node to this list.\n                    e.drop.get('node').get('parentNode').insertBefore(drag, drop);\n                    // Resize this nodes shim, so we can drop on it later.\n                    e.drop.sizeShim();\n                }\n            });\n\n            Y.DD.DDM.on('drag:drophit', function(e) {\n                var drop = e.drop.get('node'),\n                    drag = e.drag.get('node');\n\n                // if we are not on an li, we must have been dropped on a ul.\n                if (!drop.hasClass(CSS.COURSEBOX)) {\n                    if (!drop.contains(drag)) {\n                        drop.appendChild(drag);\n                    }\n                }\n            });\n        });\n    };\n\n    var savemove = function() {\n        var sortorder = Y.all(SELECTORS.FAVOURITECOURSEBOX).getData('courseid');\n\n        var params = {\n            sesskey : M.cfg.sesskey,\n            sortorder : sortorder\n        };\n\n        Y.io(URL, {\n            method: 'POST',\n            data: build_querystring(params),\n            context: this,\n            on: {\n                end: function() {\n                    var favids = sortorder;\n                    Y.fire('culcourse-listing:update-favourites', {\n                        favourites: favids\n                    });\n                }\n            }\n        });\n    };\n\n    return {\n        initializer: function(params) {\n            adddragdrop(params);\n        }\n    };\n});\n"],"file":"favourite.min.js"}