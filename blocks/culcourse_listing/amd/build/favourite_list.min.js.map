{"version":3,"sources":["../src/favourite_list.js"],"names":["define","$","ajax","templates","notification","str","url","Y","ModalFactory","ModalEvents","KeyCodes","Favourite","MyOverview","StarredCourses","CSS","BUTTONALERT","FAVOURITEADD","FAVOURITEREMOVE","SELECTORS","COURSEBOXLIST","COURSEBOX","COURSEBOXSPINNERLOCATION","COURSEBOXLISTCOURSEBOX","FAVOURITELIST","FAVOURITECOURSEBOX","FAVOURITEICON","FAVOURITECLEARBUTTON","FAVOURITECLEARINPUT","FAVOURITEREORDERBUTTON","FAVOURITEREORDERINPUT","URLREORDER","M","cfg","wwwroot","URLCLEAR","setupfavourites","courselist","all","each","node","initializer","build_querystring","obj","list","k","encodeURIComponent","value","Array","i","push","join","reorder","e","preventDefault","params","sesskey","args","message","util","get_string","callback","one","transition","duration","easing","opacity","io","data","on","success","id","replace","Node","create","responseText","setStyle","failure","end","favids","getData","fire","favourites","show_confirm_dialog","clear","scope","context","remove","favouriteiconlist","link","get","href","split","querystring","newurl","title","set","removeClass","addClass","hide","html","roots","init","publish","broadcast"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * A javascript module to ...\n *\n * @package    block_culcourse_listing\n * @copyright  2019 Amanda Doughty\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/ajax', 'core/templates', 'core/notification', 'core/str', 'core/url', 'core/yui',\n        'core/modal_factory', 'core/modal_events', 'core/key_codes', 'block_culcourse_listing/favourite',\n        'block_myoverview/main', 'block_starredcourses/main'],\n    function($, ajax, templates, notification, str, url, Y, ModalFactory, ModalEvents, KeyCodes, Favourite,\n        MyOverview, StarredCourses) {\n\n    var CSS = {\n            BUTTONALERT: 'btn-danger',\n            FAVOURITEADD: 'fa fa-star-o',\n            FAVOURITEREMOVE: 'gold fa fa-star',\n        };\n    var SELECTORS = {\n        COURSEBOXLIST: '.block_culcourse_listing  .course_category_tree',\n\n        COURSEBOX: '.culcoursebox',\n        COURSEBOXSPINNERLOCATION: '.coursename a',\n        COURSEBOXLISTCOURSEBOX: '.course_category_tree .culcoursebox',\n        FAVOURITELIST: '.favourite_list',\n        FAVOURITECOURSEBOX: '.favourite_list .culcoursebox',\n        FAVOURITEICON: '.favouritelink i',\n        FAVOURITECLEARBUTTON: '.block_culcourse_listing #clearfavourites',\n        FAVOURITECLEARINPUT: '.block_culcourse_listing #clearfavourites [type=submit]',\n        FAVOURITEREORDERBUTTON: '.block_culcourse_listing #reorderfavourites',\n        FAVOURITEREORDERINPUT: '.block_culcourse_listing #reorderfavourites [type=submit]',\n    };\n    var URLREORDER = M.cfg.wwwroot + '/blocks/culcourse_listing/reorderfavourites_ajax.php';\n    var URLCLEAR = M.cfg.wwwroot + '/blocks/culcourse_listing/clearfavourites_ajax.php';\n\n    var setupfavourites = function() {\n        var courselist = Y.all(SELECTORS.FAVOURITECOURSEBOX);\n\n        courselist.each(function(node){\n            var config = {node: node};\n            Favourite.initializer(config);\n        });\n    };\n\n    var build_querystring = function (obj) {\n        if (typeof obj !== 'object') {\n            return null;\n        }\n\n        var list = [];\n\n        for(var k in obj) {\n            k = encodeURIComponent(k);\n            var value = obj[k];\n\n            if(obj[k] instanceof Array) {\n                for(var i in value) {\n                    list.push(k + '[]=' + encodeURIComponent(value[i]));\n                }\n            } else {\n                list.push(k + '=' + encodeURIComponent(value));\n            }\n        }\n\n        return list.join('&');\n    };\n\n    var reorder = function(e) {\n        e.preventDefault();\n\n        var params = {\n            sesskey : M.cfg.sesskey\n        };\n        var args = {};\n        args.message = M.util.get_string('reorderfavouritescheck', 'block_culcourse_listing');\n\n        args.callback = function() {\n            Y.one(SELECTORS.FAVOURITELIST).transition ({\n                 duration: 2.0,\n                 easing: 'ease-in',\n                 opacity: 0\n            });\n\n            Y.io(URLREORDER, {\n                data: build_querystring(params),\n                on: {\n                    success: function(id, e) {\n                        Y.one(SELECTORS.FAVOURITELIST).replace(Y.Node.create(e.responseText).setStyle('opacity', 0));\n                        setupfavourites();\n\n                        Y.one(SELECTORS.FAVOURITELIST).transition ({\n                             duration: 2.0,\n                             easing: 'ease-in',\n                             opacity: 1\n                        });\n                    },\n                    failure: function() {\n                        // Not currently used.\n                    },\n                    end: function() {\n                        var favids = [];\n                        Y.all(SELECTORS.FAVOURITECOURSEBOX).each(function(node) {\n                            favids.push(node.getData('courseid'));\n                        });\n                        Y.fire('culcourse-listing:update-favourites', {\n                            favourites: favids\n                        });\n                    }\n                }\n            });\n        };\n\n        M.util.show_confirm_dialog(e, args);\n    };\n\n    var clear = function(e) {\n        e.preventDefault();\n\n        var params = {\n            sesskey : M.cfg.sesskey\n        };\n\n        var args = {};\n        args.message = M.util.get_string('clearfavouritescheck', 'block_culcourse_listing');\n        args.scope = this;\n\n        args.callback = function(){\n            Y.io(URLCLEAR, {\n                context: this,\n                data: build_querystring(params),\n                on: {\n                    success: function() {\n                        // Remove all courses from the favourite area.\n                        Y.all(SELECTORS.FAVOURITECOURSEBOX).remove();\n                        // Change the category course styles and links.\n                        var favouriteiconlist = Y.all(SELECTORS.FAVOURITEICON);\n\n                        favouriteiconlist.each(function(node) {\n                            // Change the link, title and icon to reflect that the course can now be\n                            // removed from favourites.\n                            var link = node.get('parentNode');\n                            var href = link.get('href').split('?');\n                            var url = href[0];\n                            var querystring = href[1];\n                            var newurl = url + '?' + querystring.replace('delete', 'add');\n                            var title = M.util.get_string('favouriteadd', 'block_culcourse_listing');\n                            link.set('href', newurl);\n                            link.set('title', title);\n                            node.removeClass(CSS.FAVOURITEREMOVE);\n                            node.addClass(CSS.FAVOURITEADD);\n                        });\n\n                        Y.all(SELECTORS.COURSEBOXSPINNERLOCATION).transition ({\n                             duration: 2.0,\n                             easing: 'ease-in',\n                             opacity: 1.0\n                        });\n\n                        $(SELECTORS.FAVOURITECLEARBUTTON).hide();\n                        $(SELECTORS.FAVOURITEREORDERBUTTON).hide();\n                        $(SELECTORS.FAVOURITELIST).html(\n                            '<span>' +\n                            M.util.get_string('nofavourites', 'block_culcourse_listing') +\n                            '</span>'\n                            );\n                    },\n                    failure: function() {\n                        // Not currently used.\n                    },\n                    end: function() {\n                        var favids = [];\n                        Y.fire('culcourse-listing:update-favourites', {\n                            favourites: favids\n                        });\n\n                        var roots = $('.block_myoverview .block-myoverview');\n                        $.each(roots, function(id, node) {\n                            MyOverview.init(node);\n                        });\n\n                        var roots = $('.block_starredcourses .block-starredcourses');\n                        $.each(roots, function(id, node) {\n                            StarredCourses.init(node);\n                        });\n                    }\n                }\n            });\n        };\n\n        M.util.show_confirm_dialog(e, args);\n    };\n\n    return {\n        initializer: function() {\n            setupfavourites();\n            // Moodle has no way of adding class to single_button object.\n            Y.one(SELECTORS.FAVOURITEREORDERINPUT).addClass(CSS.BUTTONALERT);\n            Y.one(SELECTORS.FAVOURITECLEARINPUT).addClass(CSS.BUTTONALERT);\n            Y.one(SELECTORS.FAVOURITEREORDERBUTTON).on('click', reorder, this);\n            Y.one(SELECTORS.FAVOURITECLEARBUTTON).on('click', clear, this);\n\n            Y.publish('culcourse-listing:update-favourites', {\n                broadcast:2\n            });\n        }\n    };\n});\n"],"file":"favourite_list.min.js"}