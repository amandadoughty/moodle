define(["jquery","core/ajax","core/config","core/notification"],function(a,b,c,d){var e={OPENALLLINK:"a#toggles-all-opened",CLOSEALLLINK:"a#toggles-all-closed",SECTIONHEAD:".sectionhead",SECTIONBODY:".sectionbody",TOGGLEHEAD:"#toggle-",TOGGLEBODY:"#togglesection-"},f=c.wwwroot+"/course/format/culcourse/setuserpreference.php",g=function(b){b.preventDefault(),a("ul.culcourse").find(".collapse").collapse("show")},h=function(b){b.preventDefault(),a("ul.culcourse").find(".collapse").collapse("hide")},i=function(b){var d=a(b.currentTarget).data("preference-key"),e={type:d,value:1,sesskey:c.sesskey},g={type:"POST",dataType:"json",data:e};a.ajax(f,g)},j=function(b){var d=a(b.currentTarget).data("preference-key"),e={type:d,value:0,sesskey:c.sesskey},g={type:"POST",dataType:"json",data:e};a.ajax(f,g)};return{init:function(b){var c=a("body");c.delegate(e.OPENALLLINK,"click",g),c.delegate(e.CLOSEALLLINK,"click",h),c.delegate(e.SECTIONBODY,"hide.bs.collapse",j),c.delegate(e.SECTIONBODY,"show.bs.collapse",i),a(e.SECTIONBODY).addClass("collapse in");for(userpref in b)if(userpref.startsWith("format_culcourse_expanded")){var d=userpref.match(/\d+/);if(d){var f=d[0];0==b[userpref]&&(a(e.TOGGLEHEAD+f).addClass("collapsed"),a(e.TOGGLEBODY+f).removeClass("in"))}}}}});