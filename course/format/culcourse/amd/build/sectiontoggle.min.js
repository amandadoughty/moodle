define(["jquery","core/ajax","core/config","core/notification"],function(a,b,c,d){var e,f={OPENALLLINK:"a#toggles-all-opened",CLOSEALLLINK:"a#toggles-all-closed",SECTIONHEAD:".sectionhead",SECTIONBODY:".sectionbody",TOGGLEHEAD:"#toggle-",TOGGLEBODY:"#togglesection-",DDPROXY:".yui3-dd-proxy"},g=c.wwwroot+"/course/format/culcourse/getuserpreference.php",h=c.wwwroot+"/course/format/culcourse/setuserpreference.php",i=function(b){b.preventDefault(),a("ul.culcourse").find(f.SECTIONBODY).collapse("show")},j=function(b){b.preventDefault(),a("ul.culcourse").find(f.SECTIONBODY).collapse("hide")},k=function(b){window.console.log("open");var c=a(b.currentTarget).data("preference-key"),d={courseid:e,sectionid:c,value:1},f={type:"POST",dataType:"json",data:d};a.ajax(h,f)},l=function(b){window.console.log("close");var c=a(b.currentTarget).data("preference-key"),d={courseid:e,sectionid:c,value:0},f={type:"POST",dataType:"json",data:d};a.ajax(h,f)};return{init:function(b){a(f.DDPROXY).find(f.SECTIONBODY).removeAttr("id"),window.console.log(a(f.DDPROXY).find(f.SECTIONBODY)),e=b;var c=a("body");c.delegate(f.OPENALLLINK,"click",i),c.delegate(f.CLOSEALLLINK,"click",j),c.delegate(f.SECTIONBODY,"hide.bs.collapse",l),c.delegate(f.SECTIONBODY,"show.bs.collapse",k);var h={courseid:b};a.post(g,h,function(){}).done(function(b){var c=b;for(var d in c)0==c[d]&&(a(f.TOGGLEHEAD+d).addClass("collapsed"),a(f.TOGGLEBODY+d).removeClass("in"))}).fail(function(a,b,c){d.exception(c)})}}});
