{"version":3,"sources":["../src/sectiontoggle.js"],"names":["define","$","Ajax","config","Notification","SELECTORS","OPENALLLINK","CLOSEALLLINK","SECTIONHEAD","SECTIONBODY","SECTIONFOOTER","TOGGLEHEAD","TOGGLEBODY","TOGGLEFOOTER","DDPROXY","SECTIONNAME","ClassName","SHOW","COLLAPSE","COLLAPSING","COLLAPSED","GETURL","wwwroot","SETURL","courseId","handleOpenAll","e","preventDefault","stopPropagation","find","collapse","handleCloseAll","handleOpen","is","target","sectionid","currentTarget","data","courseid","value","ajax","type","dataType","removeClass","attr","handleClose","addClass","init","body","delegate","post","done","then","sectiontoggles","document","trigger","Event","fail","jqXHR","status","error","exception"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Section collapse functions for CUL Course Format\n *\n * @package    course/format\n * @subpackage cul\n * @copyright  2016 Amanda Doughty <amanda.doughty.1@city.ac.uk>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n *\n */\n\n/**\n * @module format_culcourse/sectiontoggle\n */\ndefine(['jquery', 'core/ajax', 'core/config', 'core/notification'], function($, Ajax, config, Notification) {\n\n     /**\n      * Used CSS selectors\n      * @access private\n      */\n    var SELECTORS = {\n        OPENALLLINK: 'a#toggles-all-opened',\n        CLOSEALLLINK: 'a#toggles-all-closed',\n        SECTIONHEAD: '.sectionhead',\n        SECTIONBODY: '.sectionbody',\n        SECTIONFOOTER: '.sectionclose',\n        TOGGLEHEAD: '.course-content #toggle-',\n        TOGGLEBODY: '#togglesection-',\n        TOGGLEFOOTER: '.course-content #footertoggle-',\n        DDPROXY: '.yui3-dd-proxy',\n        SECTIONNAME: '.sectionname a'\n        };\n    // From Bootstrap collapse.js.\n    var ClassName = {\n        SHOW: 'show',\n        COLLAPSE: 'collapse',\n        COLLAPSING: 'collapsing',\n        COLLAPSED: 'collapsed'\n    };\n\n    var GETURL = config.wwwroot + '/course/format/culcourse/getuserprefsections.php';\n    var SETURL = config.wwwroot + '/course/format/culcourse/setuserprefsections.php';\n    var courseId;\n\n    /**\n     * Opens all collapsed sections.\n     *\n     * @access private\n     * @method handleOpenAll\n     * @param {event} e\n     */\n    var handleOpenAll = function(e){\n        e.preventDefault();\n        e.stopPropagation();\n\n        $('ul.culcourse').find(SELECTORS.SECTIONBODY).collapse('show');\n    };\n\n    /**\n     * Closes all open sections.\n     *\n     * @access private\n     * @method handleOpenAll\n     * @param {event} e\n     */\n    var handleCloseAll = function(e){\n        e.preventDefault();\n        e.stopPropagation();\n\n        $('ul.culcourse').find(SELECTORS.SECTIONBODY).collapse('hide');\n    };\n\n    /**\n     * Saves user preference.\n     *\n     * @access private\n     * @method handleOpen\n     * @param {event} e\n     */\n    var handleOpen = function(e){\n        e.stopPropagation();\n\n        if ($(this).is(e.target)) {\n            var sectionid = $(e.currentTarget).data('preference-key');\n\n            var data = {\n                courseid: courseId,\n                sectionid: sectionid,\n                value: 1,\n                // sesskey: config.sesskey,\n            };\n\n            var settings = {\n                type: 'POST',\n                dataType: 'json',\n                data: data\n            };\n\n            $.ajax(SETURL, settings);\n                // .fail(function (request, status, error) {\n                //     Notification.exception(request);\n                //     console.log(error);\n                // });\n\n            $(SELECTORS.TOGGLEHEAD + sectionid).removeClass(ClassName.COLLAPSED).attr('aria-expanded', true);\n            $(SELECTORS.TOGGLEFOOTER + sectionid).removeClass(ClassName.COLLAPSED).attr('aria-expanded', true);\n        }\n    };\n\n    /**\n     * Saves user preference.\n     *\n     * @access private\n     * @method handleClose\n     * @param {event} e\n     */\n    var handleClose = function(e){\n        e.stopPropagation();\n\n        if ($(this).is(e.target)) {\n            var sectionid = $(e.currentTarget).data('preference-key');\n\n            var data = {\n                courseid: courseId,\n                sectionid: sectionid,\n                value: 0,\n                // sesskey: config.sesskey,\n            };\n\n            var settings = {\n                type: 'POST',\n                dataType: 'json',\n                data: data\n            };\n\n            $.ajax(SETURL, settings);\n\n            $(SELECTORS.TOGGLEHEAD + sectionid).addClass(ClassName.COLLAPSED).attr('aria-expanded', false);\n            $(SELECTORS.TOGGLEFOOTER + sectionid).addClass(ClassName.COLLAPSED).attr('aria-expanded', false);\n        }\n    };\n\n    return /** @alias module:format_culcourse/sectiontoggle */ {\n        /**\n         * Initialize sectiontogglemanager\n         * @access public\n         * @param {int} courseid\n         */\n        init : function(courseid) {\n            courseId = courseid;\n            var body = $('body');\n\n            body.delegate(SELECTORS.SECTIONNAME, 'click', function(e) {e.preventDefault();});\n\n            body.delegate(SELECTORS.OPENALLLINK, 'click', handleOpenAll);\n            body.delegate(SELECTORS.CLOSEALLLINK, 'click', handleCloseAll);\n\n            body.delegate(SELECTORS.SECTIONBODY, 'hide.bs.collapse', handleClose);\n            body.delegate(SELECTORS.SECTIONBODY, 'show.bs.collapse', handleOpen);\n\n            // Get the userprefs. They are too large to pass to the function.\n            var params = {\n                courseid: courseid,\n                // userid: userid,\n                // sesskey: M.cfg.sesskey\n            };\n            $.post(GETURL, params, function() {})\n                .done(function() {\n                    // No user preference set - close all CMDLTWO-1789.\n                    $(SELECTORS.SECTIONHEAD).addClass(ClassName.COLLAPSED);\n                    $(SELECTORS.SECTIONFOOTER).addClass(ClassName.COLLAPSED);\n                    $(SELECTORS.SECTIONBODY).removeClass(ClassName.SHOW);\n                })\n                .then(function(data) {\n                    var sectiontoggles = data;\n\n                    for (var sectionid in sectiontoggles) {\n                        // If expanded is set to true then change the classes to\n                        // expand the section.\n                        if (sectiontoggles[sectionid] == 1) {\n                            $(SELECTORS.TOGGLEHEAD + sectionid).removeClass(ClassName.COLLAPSED);\n                            $(SELECTORS.TOGGLEFOOTER + sectionid).removeClass(ClassName.COLLAPSED);\n                            $(SELECTORS.TOGGLEBODY + sectionid).addClass(ClassName.SHOW);\n                        }\n                    }\n                })\n                .then(function() {\n                    $(document).trigger($.Event('culcoursesectiontoggle'));\n                })\n                .fail(function(jqXHR, status, error) {\n                    Notification.exception(error);\n                });\n        }\n    };\n});"],"file":"sectiontoggle.min.js"}