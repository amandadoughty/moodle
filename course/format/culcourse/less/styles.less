/**
 * CUL Course Format Information
 *
 * A collapsed format that solves the issue of the 'Scroll of Death' when a course has many sections. All sections
 * except zero have a toggle that displays that section. One or more sections can be displayed at any given time.
 * Toggles are persistent on a per browser session per course basis but can be made to persist longer.
 *
 * @package    course/format
 * @subpackage culcourse
 * @version    See the value of '$plugin->version' in version.php.
 * @author     Amanda Doughty
 * @license    http://www.gnu.org/copyleft/gpl.html GNU Public License
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.

 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.

 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
*/

/* MIXINS */
// Border Radius
.border-radius(@radius) {
  -webkit-border-radius: @radius;
     -moz-border-radius: @radius;
          border-radius: @radius;
}
// Box sizing
.box-sizing(@boxmodel) {
  -webkit-box-sizing: @boxmodel;
     -moz-box-sizing: @boxmodel;
          box-sizing: @boxmodel;
}
// Gradient
.horizontal-three-colors(@startColor: #00b3ee, @midColor: #7a43b6, @colorStop: 50%, @endColor: #c3325f) {
    background: @endColor;
    // background-image: -webkit-gradient(left, linear, 0 0, 0 100%, from(@startColor), color-stop(@colorStop, @midColor), to(@endColor));
    background: -webkit-gradient(linear, left top, right top, from(@startColor), to(@bodybg), color-stop(@colorStop, @bodybg));
    background: -webkit-linear-gradient(to right, @startColor, @midColor @colorStop, @endColor);
    background: -moz-linear-gradient(to right, @startColor, @midColor @colorStop, @endColor);
    background: -o-linear-gradient(to right, @startColor, @midColor @colorStop, @endColor);
    background: linear-gradient(to right, @startColor, @midColor @colorStop, @endColor);
    background-repeat: no-repeat
;    filter: e(%("progid:DXImageTransform.Microsoft.gradient(startColorstr='%d', endColorstr='%d', GradientType=0)",argb(@startColor),argb(@endColor))); // IE9 and down, gets no color-stop at all for proper fallback

}

/* COLOURS */
@widgetbg: #f5f5f5;
@widgetbg-hover: #e3e3e3;
@widgetborder: #e3e3e3;
@bodybg: #ffffff;
@gray: #888888;
@gray-dark: #333;

/* IMAGES */
@collapsed: '[[pix:t/collapsed]]';
@expanded: '[[pix:t/expanded]]';

/* VARIABLES */
@baseBorderRadius: 2px;

body.format-culcourse .course-content {
	ul.culcourse {
		display: block;
	    margin: 0px;
	    li.section {
	    	 vertical-align: top;
			.content {
			    margin: 0 !important; /* Override default for tablets / mobiles.  When have sides, set in format.php. */
	    		padding: 0;
	    		.summary {
				    margin-left: 0.2em;
				    margin-right: 0.2em; /* to match activity sumary*/
				    padding-left: 28px;
				    background-color: transparent !important;
				}
				.sectionhead {
					position: relative;
					padding-bottom: 1.5em; /* to fit activity list - one line */
					h3 {
					    margin: 0em;
					}
					.summary_open {
					    .truncate {
					    	display: none;
					    }
					    .no-overflow {
					    	display: inline-block;
					    }
					}
					.summary_closed {
						.truncate {
							display: inline-block;
				            overflow: hidden;
				            height: 3.4em;
				            width: 100%;
				            line-height: 16px;
				 			&:before {
					            content:"";
					            float: left;
					            width: 5px;
					            height: 3.4em;
					        }
							> *:first-child {
					            float: right;
					            width: 100%;
					            margin-left: -5px;
					        }
				        	&:after {
					            content: "\02026";
					            float: right;
					            position: relative;
					            top: -16px;
					            left: 100%;
					            width: 50%;
   								margin-left: -50%;
					            padding-right: 5px;
					            text-align: right;
					            .horizontal-three-colors(rgba(255, 255, 255, 0), @widgetbg, 50%, @widgetbg);
					        }
				    	}
				    	.no-overflow {
					    	display: none;
					    }
				    }
				}
				.sectionbody {
					background-color: @bodybg;
					padding-right: 4px;
					.summary_open {
					    margin-left: 0.2em;
					    padding-left: 0;
					    padding-top: 1em;
					    .truncate {
					    	display: none;
					    }
					    .no-overflow {
					    	display: inline-block;
					    }
					}
					.summary_closed {
						.truncate {
					    	display: none;
					    }
				    	.no-overflow {
					    	display: none;
					    }
					}
				}
				.summarytext {
					 ul {
					    list-style: disc outside none;
					}
					 ol {
					    list-style: decimal outside none;
					}
				}
				ul.section {
					margin: 0;
				}
				.toggledsection {
				    padding: 0px 0 5px 0px;
    				min-height: 30px;
					&.sectionopen {
						border-radius: 4px;
					}
				}
				.toggle {
					display: block;
			        min-height: 3.5em;
    				text-align: left;
    				background-color: @widgetbg;
    				.border-radius(@baseBorderRadius*2);
    				&:hover {
				        background-color: @widgetbg-hover;
				        .truncate:after {
				            .horizontal-three-colors(rgba(255, 255, 255, 0), @widgetbg-hover, 50%, @widgetbg-hover);
				        }
    				}
					.the_toggle {
						/* -- Set the clickable element of the Toggle -- */
					    display: block;
					    width: auto;
					    margin: 0px 4px;
					    padding: 6px 0 0 24px; /* The 24px allows the arrow to be with the text next to it. */
					    /* Toggle icon size */
				        background-size: 24px 24px;
			            background-repeat: no-repeat;
					    background-color: transparent;
					    background-position: left 100%;
					    text-decoration: none;
    					font-weight: bold;
        				text-align: left;
		    			h3 {
						    margin: 0px;
						    padding: 0 5px;
						    line-height: 24px;
						    word-break: normal;
						    overflow-wrap: normal;
						    word-wrap: normal;
						}
						p {
    						font-size: 1.2em;
						    font-style: italic;
						    text-align: left;
						}
					}
					.section-summary-activities {
						position: absolute;
						right: 4px;
						bottom: 0;
				        margin-right: 4px;
					    .activity-count {
						    margin-left: 10px;
						}
					}
					.section-summary-progress {
						position: absolute;
						left: 31px;
						bottom: 0;
				        margin-right: 4px;
				    }
				}
				.toggle-arrow a.toggle_open,
				.toggle-arrow a.toggle_closed { /* JavaScript disabled */
				    background-image: url(@expanded);
				}
				.activity {
					z-index: 999;
					.mod-indent-outer {
						padding-left: 0px;
					}
				}
				&.sectionhidden {
					display: block;
	    			text-align: left;
	    			padding: 6px 0px;
	    			text-decoration: none;
	    			font-weight: bold;
	    			background-color: @widgetbg;
	    			.border-radius(@baseBorderRadius*2);
					h3 {
					    margin: 0px;
					    word-break: normal;
					    overflow-wrap: normal;
					    word-wrap: v;
					}
				}
			}
			&.showsectionsummary {
				min-height: 7em;
				.toggle {
					min-height: 7em;
				}
			}
			.left {
				display: none;
			    float: left;
			    .section-handle img.icon {
				    padding: 0;
				    vertical-align: baseline;
				}
			}
			.right {
				display: none;
			    float: right;
			    line-height: 1.3;
			    a {
				    display: block;  /* So that section_right_content() does not implode with 'br's and get too many when the up arrow is removed by JS. */
				}
				img.hide {
				    display: inline-block;
				}
				/* -- For centring the 'Topic / Week / Day x' text -- */
				span.cps_centre {
				    text-align: center;
				    font-size: 0.7em;
				}
			}
			.spacer {
			    height:0.5em;
			}
		}
		li.section.main,
	    li#toggle-all {
		    list-style: none;
		    margin: 4px 1px 1px 1px !important;
		    padding: 0px;
		    .content {
		    	h4 a {
		    		background-size: 24px 24px;
				    background-repeat: no-repeat;
				    background-color: transparent;
				    margin: 0px 4px;
				}
				.toggle-arrow h4 {
					a.on {
					    background-image: url(@collapsed);
					}
					a.off {
					    background-image: url(@expanded);
					}
				}
				.toggle-arrow-hover h4 {
					a.on:hover {
					    background-image: url(@expanded);
					}
					a.off:hover {
					    background-image: url(@collapsed);
					}
				}
			}
			.activity {
				margin: 0.5em 0;
			}
			.side {
			    /* width: 40px; Default used in editing mode. */
			    text-align: center;
			    padding: 0px;
			}
		}
		li.section.main {
			border: none;
			.left {
			    padding: 10px 0px 0px 0px;
			}
		}
		li#toggle-all { /* .tcsection ? */
			display: none; /* Hide when JavaScript not enabled. */
			.content .sectionbody h4 {
			    display: block;
			    padding: 6px 0px;
			    margin-bottom: 0em;
			    text-align: left;
			    a {
			    	padding: 7px 26px; /* The 26px allows the arrow to be with the text next to it. */
				    width: 35px;
				    text-decoration: none;
				    text-align: left;
				}
			}
			.side {
			    width: 0; /* Default used in editing mode. */
			}
			.left {
			    float: left;
			}
			.right {
			    float: right;
			}
		}
		li.section.current {
			.content {
				.toggle {
			        margin: 2px;
			        a {
				        margin-left: 2px;
				    }
				    h3 {
				    	font-weight: bold;
				    }
				}
				.sectionbody {
					margin: 2px;
					ul.section {
				        margin-left: 4px;
				        margin-right: 4px;
				    }
				    .section-modchooser {
				    	margin-right: 4px;
				    }
				}
				.moodle-core-dragdrop-draghandle {
					color: @gray;
				}
		    }
		}
		li.section.current.main .right {
		    padding: 0; /* Cancel out effect of above when having to use 'left' side selector for getting the correct text colour on the right for the current section.  This is because the selector '.course-content .current .left' defines the colour in the theme and therefore any CT specific 'right' implementation would not work for all themes. */
		}
		li#section-0 {
			h3 {
				font-size: 24px;
				font-weight: bold;
			}
			.summary {
				padding-left: 0;
			}
		}
		li.section.hidden {
			.sectionname, 
			.content > div, 
			.activity .activityinstance {
			    margin-left: 0;
			    margin-right: 0;
			}
		}
	}
	.dash-panel {
        .box-sizing(border-box);
        width: 100%;
        border: 1px solid @widgetborder;
        .border-radius(@baseBorderRadius);
        margin: 0 0 3px 0;
        padding: 2px;
        > div.panel-header {
            border: none;
            .border-radius(@baseBorderRadius);
            background-color: @widgetbg;
            padding: 0 4px 0 4px;
            margin-bottom: 2px;
            font-weight: 500;
        }
        .linkscontainer ul.links {
	        margin: 0;
	        padding: 2px;
	        list-style: none;
		    li {
		        .box-sizing(border-box);
		        display: block;
		        float: left;
		        text-align: left;
		        padding: 0;
		        margin: 0;
		        width: 25%;
		        border: none;
		        span.dash-link {
		        	position: relative;
					display: block;
					margin: 3px;
					padding: 1px 3px;
					border: 1px solid @widgetborder;
					.border-radius(@baseBorderRadius*0.5);
					height: 2em;
					overflow: hidden;
		            a {
		            	display: inline-block;
		            	line-height: 2em;
				        border-bottom: medium none !important;
				        i {
				        	margin: 0 0.3em;
				        	color: @gray;
				        	font-size: 1rem;
				        }
				        img.iconsmall {
				        	width: 1rem;
				        	height: 1rem;
				        }
				        /** 'disabled'/unavailable links **/
					    &.nolink,
					    &:hover.nolink,
					    &:visited.nolink {
					        text-decoration: none !important;
					        color: @gray !important;
					        cursor: default;
					    }
					    &.quicklinkedit{
					    	position: absolute;
					    	right: 0;
					    	i {
					    		margin-top: 7px;
					    		color: inherit;
					    		&:hover {
					    			color: inherit;
					    		}

					    	}
					    }
				    }
				    &.linkhidden {
				    	border: 1px dashed @gray-dark;
				    	opacity: 0.7;
				    }				    
				}
		    }
		}
    }
    .module-summary > div.panel-content {
        padding: 2px !important;
        margin:  2px !important;
    }
}

body.format-culcourse.jsenabled {
	.course-content {
		ul.culcourse {
		    li.section {
				.content {
					.toggle-arrow a.toggle_open { /* JavaScript enabled */
					    background-image: url(@expanded);
					}
					.toggle-arrow a.toggle_closed { /* JavaScript enabled */
					    background-image: url(@collapsed);
					}
					.toggledsection {
					    display: none; /* If JavaScript is enabled then this css will apply and the section will be hidden. */
					}
					.toggledsection.sectionopen {
					    display: block;
					}
				}
			}
			li#toggle-all { /* .tcsection ? */
				background: none repeat scroll 0 0 transparent;
    			display: block;
    			.content h4 {
    				font-size: 1.4em;
    				a {
	    				background-position: left;
	    			}
    			}
			}
		}
	}
}

body.format-culcourse.editing {
	.course-content {
		ul.culcourse {
		    li.section {
				.content {
					.toggle {
						min-height: 7em;
					}
					.summary {
						border: none !important;
					}
				    .activity {
				    	margin: 0.5em 0;
				    	.mod-indent-outer {
					    	padding-left: 32px;
					    }
					    .actions {
						    position: absolute;
						}
						.contentwithoutlink,
						.activityinstance {
						    padding-right: 0px;
						    display: inline-block;
						    margin-right: 7em;
						}
						.editing_move {
							top: 25%;
						}
					}
				}
				.right {
					display: block;
					.fa {
						display: inline-block;
						font-size: 1.2em;
						padding: 2px 0;
					}
					img {
						display: none;
					}
				}
				&.current .right .fa {
					color: @bodybg;
				}
				.left {
					display: block;
				}
			}
			li.section.main,
	    	li.tcsection {
	    		.content {
			        margin: 0 40px !important;
			        padding: 0 !important;
				}
			}
		}
	}
}

/* css for photoboard */
body.format-culcourse.path-format-culcourse-photos {
	table.controls td {
	    padding: 0;
	}
	.rolesform {
		margin-bottom: 1em;
	}
    .searchform {
        clear: both;
    }
	table.userinfobox {
		margin-bottom: 1em;
		th,
		td {
		    padding: 0px;
		    text-align: left;
		    .username {
		  	    padding-bottom: 5px;
		    }
		}
		td.links {
			width: 150px;
			vertical-align: top;
			font-size: 0.9em;
		}
	}
	.gallerycontainer {
		float: left;
	}
	.galleryItem {
	    float: left;
	    width: 130px;
	    height: 150px;
	    overflow: hidden;
	    margin: 0px 10px 10px 0px;
	    strong {
	        font-size: 95%;
	    }
	    img {
	        height: 100px;
	        width: 100px;
	        .border-radius(@baseBorderRadius*1.5);
	    }
	}
}

.moodle-core-dragdrop-draghandle {
	display: inline-block;
	color: @gray;
	font-family: FontAwesome;
	&:before {
		content: "\f047";
	}
	img {
		display: none;
	}
}

.course-content {
	ul.culcourse {
		.moodle-core-dragdrop-draghandle {
			font-size: 1.2em;
		}
		.current .moodle-core-dragdrop-draghandle {
			color: @bodybg;
		}
	}
}

.used-region-side-pre.used-region-side-post.editing .course-content {
	ul.culcourse li.section.showsectionsummary .content .toggle {
		/*min-height: 9em;*/
	}
	.dash-panel .linkscontainer ul.links li {
        .box-sizing(border-box);
        width: 33.33%;
        max-width: none;
    }
}

.format-culcourse {
	#changenumsections {
		text-align: center;
		.sectionbutton {
			display: inline-block;
			margin: 1rem;
		}
	}
}

@media (max-width: 1200px) {
	.used-region-side-pre.used-region-side-post .course-content {
		ul.culcourse li.section.showsectionsummary .content .toggle {
			/*min-height: 9em;*/
		}
		.dash-panel .linkscontainer ul.links li {
	        .box-sizing(border-box);
	        width: 33.33%;
	        max-width: none;
	    }
    }
}

@media (max-width: 1000px) {
	.course-content {
		ul.culcourse li.section.showsectionsummary .content .toggle {
			/*min-height: 9em;*/
		}
		.dash-panel .linkscontainer ul.links li {
	        .box-sizing(border-box);
	        width: 33.33%;
	        max-width: none;
	    }
    }
    .used-region-side-pre.used-region-side-post.editing .course-content {
		ul.culcourse li.section.showsectionsummary .content .toggle {
			/*min-height: 9em;*/
		}
		.dash-panel .linkscontainer ul.links li {
	        .box-sizing(border-box);
	        width: 50%;
	        max-width: none;
	    }
    }
}

@media (max-width: 767px) {
	.used-region-side-pre.used-region-side-post .course-content {
		ul.culcourse li.section.showsectionsummary .content .toggle {
			/*min-height: 9em;*/
		}
		.dash-panel .linkscontainer ul.links li {
	        .box-sizing(border-box);
	        width: 50%;
	        max-width: none;
	    }
    }
}

@media (max-width: 480px) {
    .course-content {
    	ul.culcourse li.section.showsectionsummary .content .toggle {
			/*min-height: 10em;*/
		}
		.dash-panel .linkscontainer ul.links li {
	        .box-sizing(border-box);
	        width: 50%;
	        max-width: none;
	    }
    	.nav-tabs
        li > a {
            font-size: 0;
        }
        img.icon {
            margin: 4px 0 0 5px;
        }
        .links li {
	        .box-sizing(border-box);
	        width: 100%;
	        max-width: none;
	    }
    }
}

/* TODO media queries */
/* MyMobile */
#mymobile .course-content ul.culcourse li.tcsection .content,
#mymobile .course-content ul.culcourse li.section.main .content {
    margin: 0;
}

#mymobile .course-content ul.culcourse li.section .content .toggle a {
    font-weight: normal; /* So not blurred on mobile devices. */
}

