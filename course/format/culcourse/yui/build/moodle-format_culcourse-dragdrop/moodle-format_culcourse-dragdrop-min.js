YUI.add("moodle-format_culcourse-dragdrop",function(e,t){var n={ACTIONAREA:"dash-edit",ACTIVITYLINK:"activitylink",ACTIVITYLINKCONTAINER:"activitylinks",ACTIVITYLINKDRAGGABLE:"activitylinkdraggable",MOVE:"dash-move",QUICKLINK:"quicklink",QUICKLINKCONTAINER:"quicklinks",QUICKLINKDRAGGABLE:"quicklinkdraggable"},r=function(){r.superclass.constructor.apply(this,arguments)};e.extend(r,M.core.dragdrop,{goingLeft:null,initializer:function(){this.groups=[n.QUICKLINKDRAGGABLE],this.quicklinklistselector="."+n.QUICKLINK;if(e.Node.all(this.quicklinklistselector).size()){this.setup_for_quicklink(this.quicklinklistselector),this.samenodeclass=n.QUICKLINK,this.parentnodeclass=n.QUICKLINKCONTAINER;var t=new e.DD.Delegate({container:"."+n.QUICKLINKCONTAINER,nodes:"."+n.QUICKLINKDRAGGABLE,target:!0,handles:["."+n.MOVE],dragConfig:{groups:this.groups}});t.dd.plug(e.Plugin.DDProxy,{moveOnEnd:!1,cloneNode:!0}),t.dd.plug(e.Plugin.DDConstrained,{constrain:"."+n.QUICKLINKCONTAINER}),t.dd.plug(e.Plugin.DDWinScroll)}},setup_for_quicklink:function(t){e.Node.all(t).each(function(e){var t=e.one("a."+n.MOVE);if(t){var r=t.get("text");t.replace(this.get_drag_handle(r,n.MOVE,n.ICONCLASS,!0))}},this)},drag_start:function(e){var t=e.target;t.get("dragNode").set("innerHTML",t.get("node").get("innerHTML"))},drag_drag:function(e){var t=e.target,n=e.info;if(!this.in_group(t))return;n.start[0]<n.xy[0]?this.absgoingleft=!0:n.start[0]>n.xy[0]&&(this.absgoingleft=!1),n.delta[0]<0?this.goingleft=!0:n.delta[0]>0&&(this.goingleft=!1),n.delta[1]!=n.xy[1]?this.vertical=!0:this.vertical=!1},drag_dropmiss:function(e){this.drop_hit(e)},drop_over:function(e){var t=e.drag.get("node"),n=e.drop.get("node"),r;this.goingleft?r="before":r="after",this.goingup&&(r="before"),n.insert(t,r)},drop_hit:function(t){var r=t.drop.get("node"),i=t.drag.get("node"),s={},o=i.one("."+n.ACTIONAREA),u=M.util.add_spinner(e,o);s.sesskey=M.cfg.sesskey,s.courseid=this.get("courseid"),s.moveto=r.getData("position"),s.copy=i.getData("position"),s.action=2,s.name=i.getData("setting");var a=M.cfg.wwwroot+this.get("ajaxurl");e.io(a,{method:"POST",data:s,on:{start:function(){u.show()},success:function(){window.setTimeout(function(){u.hide()},250)},failure:function(e,t){this.ajax_failure(t),u.hide()}},context:this})}},{NAME:"format_culcourse_quicklinkdd",ATTRS:{courseid:{value:null},ajaxurl:{value:0},config:{value:0}}}),M.format_culcourse=M.format_culcourse||{},M.format_culcourse.init_quicklinkdd=function(e){new r(e)};var i=function(){i.superclass.constructor.apply(this,arguments)};e.extend(i,M.core.dragdrop,{goingLeft:null,initializer:function(){this.groups=[n.ACTIVITYLINKDRAGGABLE],this.activitylinklistselector="."+n.ACTIVITYLINK;if(e.Node.all(this.activitylinklistselector).size()){this.setup_for_activitylink(this.activitylinklistselector),this.samenodeclass=n.ACTIVITYLINK,this.parentnodeclass=n.ACTIVITYLINKCONTAINER;var t=new e.DD.Delegate({container:"."+n.ACTIVITYLINKCONTAINER,nodes:"."+n.ACTIVITYLINKDRAGGABLE,target:!0,handles:["."+n.MOVE],dragConfig:{groups:this.groups}});t.dd.plug(e.Plugin.DDProxy,{moveOnEnd:!1,cloneNode:!0}),t.dd.plug(e.Plugin.DDConstrained,{constrain:"."+n.ACTIVITYLINKCONTAINER}),t.dd.plug(e.Plugin.DDWinScroll)}},setup_for_activitylink:function(t){e.Node.all(t).each(function(e){var t=e.one("a."+n.MOVE);if(t){var r=t.get("text");t.replace(this.get_drag_handle(r,n.MOVE,n.ICONCLASS,!0))}},this)},drag_start:function(e){var t=e.target;t.get("dragNode").set("innerHTML",t.get("node").get("innerHTML"))},drag_drag:function(e){var t=e.target,n=e.info;if(!this.in_group(t))return;n.start[0]<n.xy[0]?this.absgoingleft=!0:n.start[0]>n.xy[0]&&(this.absgoingleft=!1),n.delta[0]<0?this.goingleft=!0:n.delta[0]>0&&(this.goingleft=!1),n.delta[1]!=n.xy[1]?this.vertical=!0:this.vertical=!1},drag_dropmiss:function(e){this.drop_hit(e)},drop_over:function(e){var t=e.drag.get("node"),n=e.drop.get("node"),r;this.goingleft?r="before":r="after",this.goingup&&(r="before"),n.insert(t,r)},drop_hit:function(t){var r=t.drop.get("node"),i=t.drag.get("node"),s={},o=i.one("."+n.ACTIONAREA),u=M.util.add_spinner(e,o);s.sesskey=M.cfg.sesskey,s.courseid=this.get("courseid"),s.moveto=r.getData("position"),s.copy=i.getData("position"),s.action=2,s.name=i.getData("setting");var a=M.cfg.wwwroot+this.get("ajaxurl");e.io(a,{method:"POST",data:s,on:{start:function(){u.show()},success:function(){window.setTimeout(function(){u.hide()},250)},failure:function(e,t){this.ajax_failure(t),u.hide()}},context:this})}},{NAME:"format_culcourse_activitylinkdd",ATTRS:{courseid:{value:null},ajaxurl:{value:0},config:{value:0}}}),M.format_culcourse=M.format_culcourse||{},M.format_culcourse.init_activitylinkdd=function(e){new i(e)}},"@VERSION@",{requires:["base","node","io","dom","dd","dd-scroll","moodle-core-dragdrop","moodle-core-notification","moodle-course-coursebase","moodle-course-util"]});
