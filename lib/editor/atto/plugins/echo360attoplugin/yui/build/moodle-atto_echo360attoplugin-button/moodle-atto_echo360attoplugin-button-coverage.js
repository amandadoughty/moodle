if (typeof __coverage__ === 'undefined') { __coverage__ = {}; }
if (!__coverage__['build/moodle-atto_echo360attoplugin-button/moodle-atto_echo360attoplugin-button.js']) {
   __coverage__['build/moodle-atto_echo360attoplugin-button/moodle-atto_echo360attoplugin-button.js'] = {"path":"build/moodle-atto_echo360attoplugin-button/moodle-atto_echo360attoplugin-button.js","s":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":0,"85":0,"86":0,"87":0,"88":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0,0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0,0,0],"15":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0},"fnMap":{"1":{"name":"(anonymous_1)","line":1,"loc":{"start":{"line":1,"column":48},"end":{"line":1,"column":67}}},"2":{"name":"(anonymous_2)","line":49,"loc":{"start":{"line":49,"column":15},"end":{"line":49,"column":27}}},"3":{"name":"(anonymous_3)","line":117,"loc":{"start":{"line":117,"column":27},"end":{"line":117,"column":61}}},"4":{"name":"(anonymous_4)","line":138,"loc":{"start":{"line":138,"column":11},"end":{"line":138,"column":24}}},"5":{"name":"(anonymous_5)","line":150,"loc":{"start":{"line":150,"column":41},"end":{"line":150,"column":54}}},"6":{"name":"(anonymous_6)","line":166,"loc":{"start":{"line":166,"column":19},"end":{"line":166,"column":32}}},"7":{"name":"(anonymous_7)","line":206,"loc":{"start":{"line":206,"column":19},"end":{"line":206,"column":31}}},"8":{"name":"(anonymous_8)","line":228,"loc":{"start":{"line":228,"column":13},"end":{"line":228,"column":25}}},"9":{"name":"(anonymous_9)","line":245,"loc":{"start":{"line":245,"column":26},"end":{"line":245,"column":38}}},"10":{"name":"(anonymous_10)","line":251,"loc":{"start":{"line":251,"column":16},"end":{"line":251,"column":28}}}},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":278,"column":61}},"2":{"start":{"line":35,"column":0},"end":{"line":35,"column":57}},"3":{"start":{"line":36,"column":0},"end":{"line":36,"column":19}},"4":{"start":{"line":37,"column":0},"end":{"line":37,"column":24}},"5":{"start":{"line":38,"column":0},"end":{"line":38,"column":17}},"6":{"start":{"line":39,"column":0},"end":{"line":39,"column":24}},"7":{"start":{"line":40,"column":0},"end":{"line":40,"column":29}},"8":{"start":{"line":41,"column":0},"end":{"line":41,"column":25}},"9":{"start":{"line":43,"column":0},"end":{"line":275,"column":3}},"10":{"start":{"line":51,"column":4},"end":{"line":55,"column":5}},"11":{"start":{"line":53,"column":6},"end":{"line":53,"column":60}},"12":{"start":{"line":54,"column":6},"end":{"line":54,"column":13}},"13":{"start":{"line":56,"column":4},"end":{"line":56,"column":34}},"14":{"start":{"line":58,"column":4},"end":{"line":62,"column":50}},"15":{"start":{"line":64,"column":4},"end":{"line":64,"column":41}},"16":{"start":{"line":65,"column":4},"end":{"line":65,"column":43}},"17":{"start":{"line":66,"column":4},"end":{"line":66,"column":41}},"18":{"start":{"line":69,"column":4},"end":{"line":69,"column":46}},"19":{"start":{"line":70,"column":4},"end":{"line":70,"column":40}},"20":{"start":{"line":71,"column":4},"end":{"line":71,"column":56}},"21":{"start":{"line":72,"column":4},"end":{"line":72,"column":44}},"22":{"start":{"line":73,"column":4},"end":{"line":73,"column":40}},"23":{"start":{"line":74,"column":4},"end":{"line":74,"column":46}},"24":{"start":{"line":77,"column":4},"end":{"line":85,"column":5}},"25":{"start":{"line":78,"column":6},"end":{"line":84,"column":7}},"26":{"start":{"line":79,"column":8},"end":{"line":79,"column":52}},"27":{"start":{"line":80,"column":8},"end":{"line":80,"column":43}},"28":{"start":{"line":81,"column":8},"end":{"line":81,"column":64}},"29":{"start":{"line":82,"column":8},"end":{"line":82,"column":41}},"30":{"start":{"line":83,"column":8},"end":{"line":83,"column":32}},"31":{"start":{"line":87,"column":4},"end":{"line":87,"column":36}},"32":{"start":{"line":89,"column":4},"end":{"line":93,"column":7}},"33":{"start":{"line":95,"column":4},"end":{"line":95,"column":57}},"34":{"start":{"line":98,"column":4},"end":{"line":106,"column":7}},"35":{"start":{"line":120,"column":4},"end":{"line":120,"column":22}},"36":{"start":{"line":122,"column":4},"end":{"line":122,"column":42}},"37":{"start":{"line":123,"column":4},"end":{"line":123,"column":18}},"38":{"start":{"line":124,"column":4},"end":{"line":128,"column":5}},"39":{"start":{"line":125,"column":6},"end":{"line":125,"column":40}},"40":{"start":{"line":127,"column":6},"end":{"line":127,"column":20}},"41":{"start":{"line":139,"column":4},"end":{"line":139,"column":23}},"42":{"start":{"line":140,"column":4},"end":{"line":140,"column":34}},"43":{"start":{"line":143,"column":4},"end":{"line":147,"column":6}},"44":{"start":{"line":148,"column":4},"end":{"line":148,"column":36}},"45":{"start":{"line":149,"column":4},"end":{"line":154,"column":5}},"46":{"start":{"line":150,"column":6},"end":{"line":153,"column":26}},"47":{"start":{"line":151,"column":8},"end":{"line":151,"column":28}},"48":{"start":{"line":152,"column":8},"end":{"line":152,"column":39}},"49":{"start":{"line":155,"column":4},"end":{"line":155,"column":42}},"50":{"start":{"line":156,"column":4},"end":{"line":156,"column":23}},"51":{"start":{"line":168,"column":4},"end":{"line":198,"column":5}},"52":{"start":{"line":169,"column":6},"end":{"line":169,"column":28}},"53":{"start":{"line":170,"column":6},"end":{"line":196,"column":7}},"54":{"start":{"line":171,"column":8},"end":{"line":171,"column":53}},"55":{"start":{"line":172,"column":8},"end":{"line":192,"column":9}},"56":{"start":{"line":173,"column":10},"end":{"line":188,"column":11}},"57":{"start":{"line":175,"column":14},"end":{"line":179,"column":33}},"58":{"start":{"line":180,"column":14},"end":{"line":180,"column":20}},"59":{"start":{"line":183,"column":14},"end":{"line":183,"column":113}},"60":{"start":{"line":184,"column":14},"end":{"line":184,"column":20}},"61":{"start":{"line":186,"column":14},"end":{"line":186,"column":88}},"62":{"start":{"line":187,"column":14},"end":{"line":187,"column":44}},"63":{"start":{"line":190,"column":10},"end":{"line":190,"column":87}},"64":{"start":{"line":191,"column":10},"end":{"line":191,"column":40}},"65":{"start":{"line":194,"column":8},"end":{"line":194,"column":61}},"66":{"start":{"line":195,"column":8},"end":{"line":195,"column":38}},"67":{"start":{"line":197,"column":6},"end":{"line":197,"column":23}},"68":{"start":{"line":207,"column":4},"end":{"line":220,"column":5}},"69":{"start":{"line":208,"column":6},"end":{"line":208,"column":151}},"70":{"start":{"line":209,"column":6},"end":{"line":214,"column":7}},"71":{"start":{"line":210,"column":8},"end":{"line":210,"column":88}},"72":{"start":{"line":211,"column":8},"end":{"line":211,"column":20}},"73":{"start":{"line":213,"column":8},"end":{"line":213,"column":62}},"74":{"start":{"line":215,"column":6},"end":{"line":215,"column":63}},"75":{"start":{"line":216,"column":6},"end":{"line":216,"column":25}},"76":{"start":{"line":218,"column":6},"end":{"line":218,"column":128}},"77":{"start":{"line":219,"column":6},"end":{"line":219,"column":18}},"78":{"start":{"line":229,"column":4},"end":{"line":229,"column":36}},"79":{"start":{"line":231,"column":4},"end":{"line":233,"column":5}},"80":{"start":{"line":232,"column":6},"end":{"line":232,"column":13}},"81":{"start":{"line":234,"column":4},"end":{"line":234,"column":35}},"82":{"start":{"line":235,"column":4},"end":{"line":235,"column":58}},"83":{"start":{"line":236,"column":4},"end":{"line":236,"column":34}},"84":{"start":{"line":237,"column":4},"end":{"line":237,"column":23}},"85":{"start":{"line":246,"column":4},"end":{"line":246,"column":17}},"86":{"start":{"line":247,"column":4},"end":{"line":247,"column":24}},"87":{"start":{"line":248,"column":4},"end":{"line":248,"column":25}},"88":{"start":{"line":252,"column":4},"end":{"line":259,"column":2}}},"branchMap":{"1":{"line":51,"type":"if","locations":[{"start":{"line":51,"column":4},"end":{"line":51,"column":4}},{"start":{"line":51,"column":4},"end":{"line":51,"column":4}}]},"2":{"line":53,"type":"binary-expr","locations":[{"start":{"line":53,"column":6},"end":{"line":53,"column":23}},{"start":{"line":53,"column":27},"end":{"line":53,"column":59}}]},"3":{"line":78,"type":"if","locations":[{"start":{"line":78,"column":6},"end":{"line":78,"column":6}},{"start":{"line":78,"column":6},"end":{"line":78,"column":6}}]},"4":{"line":124,"type":"if","locations":[{"start":{"line":124,"column":4},"end":{"line":124,"column":4}},{"start":{"line":124,"column":4},"end":{"line":124,"column":4}}]},"5":{"line":149,"type":"if","locations":[{"start":{"line":149,"column":4},"end":{"line":149,"column":4}},{"start":{"line":149,"column":4},"end":{"line":149,"column":4}}]},"6":{"line":168,"type":"if","locations":[{"start":{"line":168,"column":4},"end":{"line":168,"column":4}},{"start":{"line":168,"column":4},"end":{"line":168,"column":4}}]},"7":{"line":168,"type":"binary-expr","locations":[{"start":{"line":168,"column":8},"end":{"line":168,"column":27}},{"start":{"line":168,"column":31},"end":{"line":168,"column":57}}]},"8":{"line":170,"type":"if","locations":[{"start":{"line":170,"column":6},"end":{"line":170,"column":6}},{"start":{"line":170,"column":6},"end":{"line":170,"column":6}}]},"9":{"line":172,"type":"if","locations":[{"start":{"line":172,"column":8},"end":{"line":172,"column":8}},{"start":{"line":172,"column":8},"end":{"line":172,"column":8}}]},"10":{"line":173,"type":"switch","locations":[{"start":{"line":174,"column":12},"end":{"line":180,"column":20}},{"start":{"line":181,"column":12},"end":{"line":181,"column":23}},{"start":{"line":182,"column":12},"end":{"line":184,"column":20}},{"start":{"line":185,"column":12},"end":{"line":187,"column":44}}]},"11":{"line":209,"type":"if","locations":[{"start":{"line":209,"column":6},"end":{"line":209,"column":6}},{"start":{"line":209,"column":6},"end":{"line":209,"column":6}}]},"12":{"line":215,"type":"binary-expr","locations":[{"start":{"line":215,"column":26},"end":{"line":215,"column":43}},{"start":{"line":215,"column":47},"end":{"line":215,"column":62}}]},"13":{"line":231,"type":"if","locations":[{"start":{"line":231,"column":4},"end":{"line":231,"column":4}},{"start":{"line":231,"column":4},"end":{"line":231,"column":4}}]},"14":{"line":253,"type":"binary-expr","locations":[{"start":{"line":253,"column":6},"end":{"line":253,"column":56}},{"start":{"line":254,"column":6},"end":{"line":255,"column":41}},{"start":{"line":256,"column":6},"end":{"line":256,"column":37}},{"start":{"line":257,"column":6},"end":{"line":257,"column":47}}]},"15":{"line":254,"type":"binary-expr","locations":[{"start":{"line":254,"column":9},"end":{"line":254,"column":45}},{"start":{"line":255,"column":6},"end":{"line":255,"column":40}}]}},"code":["(function () { YUI.add('moodle-atto_echo360attoplugin-button', function (Y, NAME) {","","// This file is part of Moodle - http://moodle.org/","//","// Moodle is free software: you can redistribute it and/or modify","// it under the terms of the GNU General Public License as published by","// the Free Software Foundation, either version 3 of the License, or","// (at your option) any later version.","//","// Moodle is distributed in the hope that it will be useful,","// but WITHOUT ANY WARRANTY; without even the implied warranty of","// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the","// GNU General Public License for more details.","//","// You should have received a copy of the GNU General Public License","// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.","","/*"," * @package    atto_echo360attoplugin"," * @copyright  COPYRIGHTINFO"," * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later"," */","","/**"," * @module moodle-atto_echo360attoplugin-button"," */","","/**"," * Atto text editor echo360attoplugin plugin."," * @namespace M.atto_echo360attoplugin"," * @class button"," * @extends M.editor_atto.EditorPlugin"," */","","var LOG_NAME = COMPONENT_NAME = 'atto_echo360attoplugin';","var EDITOR_ID = '';","var ECHO360 = 'echo360';","var MEDIA = null;","var MESSAGE_DATA = null;","var ADD_MESSAGE_HANDLER = {};","var EDITOR_INSTANCE = {};","","Y.namespace('M.atto_echo360attoplugin').Button = Y.Base.create('button', Y.M.editor_atto.EditorPlugin, [], {","","  /**","   * Initialize the button","   * @method Initializer","   */","  initializer: function () {","    // If we don't have the capability to view then give up.","    if (this.get('disabled')) {","      // It may not be disabled because of an error","      this.get('error') && console.error(this.get('error'));","      return;","    }","    EDITOR_ID = this.editor._yuid;","","    var icon = 'echoIcon',","        json = this.get('ltiConfiguration'),","        ltiConfiguration = JSON.parse(json),","        iframeName = 'echo360-library-' + EDITOR_ID,","        iframe = document.createElement('iframe');","","    iframe.id = iframe.name = iframeName;","    iframe.setAttribute('height', '500px');","    iframe.setAttribute('width', '100%');","","    // Configure the LTI authentication form to target the iframe on submit","    var form = document.createElement('form');","    form.setAttribute('method', 'post');","    form.setAttribute('id', 'echo360-form' + EDITOR_ID);","    form.setAttribute('target', iframeName);","    form.setAttribute('hidden', 'true');","    form.action = ltiConfiguration.launch_url;","","    // Create an input field in the form for each LTI parameter","    for (var property in ltiConfiguration) {","      if (ltiConfiguration.hasOwnProperty(property)) {","        var input = document.createElement('input');","        input.setAttribute('type', 'text');","        input.setAttribute('value', ltiConfiguration[property]);","        input.id = input.name = property;","        form.appendChild(input);","      }","    }","    // The form must be part of the DOM before you can submit it","    document.body.appendChild(form);","","    var dialogue = this.getDialogue({","      headerContent: M.util.get_string('dialogtitle', COMPONENT_NAME),","      focusAfterHide: this.editor,","      width: 800","    });","","    this._attachIframeToDialogue(dialogue, iframe, form);","","    // The button will display the Dialogue modal","    this.addButton({","      icon: 'ed/' + icon,","      iconComponent: 'atto_echo360attoplugin',","      buttonName: icon,","      callback: this._doOpen,","      callbackArgs: null,","      name: ECHO360,","      tooltip: ECHO360","    });","  },","","  /**","   * Attaches the IFrame to the Dialogue modal","   * @method _attachIframeToDialogue","   * @param dialogue {Element} The dialogue element that serves as a container for the iframe","   * @param iframe {Element} The iframe element to display the user library","   * @param form {Element} The form element to submit the LTI auth request targeting the iframe","   * @private","   */","  _attachIframeToDialogue: function (dialogue, iframe, form) {","    // Dialogue modal must be showing in order to append the iframe properly.","    // It will happen so fast that the end user will not see it","    dialogue.render();","    // Append the iframe to the Dialogue modal, submit the form, then remove it","    dialogue.bodyNode.appendChild(iframe);","    form.submit();","    if(this._browserIsIE()){","      form.parentNode.removeChild(form);","    } else {","      form.remove();","    }","  },","","  /**","   * Opens the modal and displays the Echo360 user library","   * @method _doOpen","   * @param e {Object} the event object","   * @param dialogue {Element} the dialogue modal element","   * @private","   */","  _doOpen: function (e) {","    e.preventDefault();","    this._resetVariablesInScope();","    // Show the Dialogue modal and add an event listener","    // for messages sent from the iframe","    EDITOR_INSTANCE = {","      host: this.get('host'),","      editor: this.editor,","      dialogue: this.getDialogue()","    };","    EDITOR_INSTANCE.dialogue.show();","    if(!ADD_MESSAGE_HANDLER[EDITOR_ID]){","      window.addEventListener('message', function (e) {","        e.stopPropagation();","        return this._receiveMessage(e);","      }.bind(this), true);","    }","    ADD_MESSAGE_HANDLER[EDITOR_ID] = true;","    this.markUpdated();","  },","","  /**","   * Handle the message received from the Echo360 user library","   * @method _receiveMessage","   * @param e {Object} the Message object sent from the IFrame.","   * Should contain information about the media we wish to embed","   * @private","   */","  _receiveMessage: function (e) {","    // Only accept messages from Echo360","    if (this._browserIsIE() || e.origin.includes(ECHO360)) {","      MESSAGE_DATA = e.data;","      if (MESSAGE_DATA) {","        var queryParameters = this._getQueryParams();","        if (queryParameters) {","          switch (queryParameters.return_type) {","            case 'iframe':","              MEDIA = '<iframe ' + 'src=\"' + queryParameters.url +","                  '\" height=\"' + queryParameters.height +","                  '\" width=\"' + queryParameters.width +","                  '\" title=\"' + queryParameters.title +","                  '\"></iframe> ';","              break;","            case 'url':","            case 'lti_launch_url':","              MEDIA = '<a href=\"' + queryParameters.url + '\" target=\"_blank\">' + queryParameters.title + '</a> ';","              break;","            default:","              console.error('Return type: ' + queryParameters.return_type + ' invalid');","              this._resetVariablesInScope();","          }","        } else {","          console.error('No parameters returned from parsed message: ' + MESSAGE_DATA);","          this._resetVariablesInScope();","        }","      } else{","        console.error('No data returned from message: ' + e);","        this._resetVariablesInScope();","      }","      this._doInsert();","    }","  },","","  /**","   * Returns the query parameters from MESSAGE_DATA as an object","   * @method _getQueryParams","   * @private","   */","  _getQueryParams: function () {","    try {","      var queryParams = JSON.parse('{\"' + decodeURI(MESSAGE_DATA.split('?')[1]).replace(/\"/g, '\\\\\"').replace(/&/g, '\",\"').replace(/=/g, '\":\"') + '\"}');","      if (!queryParams.hasOwnProperty('url')) {","        console.error('Required parameter \"url\" missing from message: ' + MESSAGE_DATA);","        return null;","      } else {","        queryParams.url = decodeURIComponent(queryParams.url);","      }","      queryParams.title = queryParams.title || queryParams.url;","      return queryParams;","    } catch (err) {","      console.error('Error caught while attempting to parse query parameters in message: ' + MESSAGE_DATA + '\\n' + err.message);","      return null;","    }","  },","","  /**","   * Inserts the users input onto the page","   * @method _doInsert","   * @private","   */","  _doInsert: function () {","    EDITOR_INSTANCE.dialogue.hide();","    // If no file is there to insert, don't do it.","    if (!MEDIA) {","      return;","    }","    EDITOR_INSTANCE.editor.focus();","    EDITOR_INSTANCE.host.insertContentAtFocusPoint(MEDIA);","    this._resetVariablesInScope();","    this.markUpdated();","  },","","  /**","   * Resets MEDIA and MESSAGE_DATA","   * @method _resetVariablesInScope","   * @private","   */","  _resetVariablesInScope: function () {","    MEDIA = null;","    MESSAGE_DATA = null;","    EDITOR_INSTANCE = {};","  },","","  _browserIsIE: function () {","    return (","      navigator.appName == 'Microsoft Internet Explorer' ||","      !!(navigator.userAgent.match(/Trident/) ||","      navigator.userAgent.match(/rv:11/)) ||","      !!document.documentMode == true ||","      navigator.userAgent.indexOf(\"MSIE\") != -1","    )","  }","","}, {","  ATTRS: {","    disabled: {","      value: false","    },","","    usercontextid: {","      value: null","    },","","    ltiConfiguration: {","      value: ''","    }","  }","});","","","}, '@VERSION@', {\"requires\": [\"moodle-editor_atto-plugin\"]});","","}());"]};
}
var __cov_U_Tkf9XQF4_lxpXrWQpZUw = __coverage__['build/moodle-atto_echo360attoplugin-button/moodle-atto_echo360attoplugin-button.js'];
__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['1']++;YUI.add('moodle-atto_echo360attoplugin-button',function(Y,NAME){__cov_U_Tkf9XQF4_lxpXrWQpZUw.f['1']++;__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['2']++;var LOG_NAME=COMPONENT_NAME='atto_echo360attoplugin';__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['3']++;var EDITOR_ID='';__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['4']++;var ECHO360='echo360';__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['5']++;var MEDIA=null;__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['6']++;var MESSAGE_DATA=null;__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['7']++;var ADD_MESSAGE_HANDLER={};__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['8']++;var EDITOR_INSTANCE={};__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['9']++;Y.namespace('M.atto_echo360attoplugin').Button=Y.Base.create('button',Y.M.editor_atto.EditorPlugin,[],{initializer:function(){__cov_U_Tkf9XQF4_lxpXrWQpZUw.f['2']++;__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['10']++;if(this.get('disabled')){__cov_U_Tkf9XQF4_lxpXrWQpZUw.b['1'][0]++;__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['11']++;(__cov_U_Tkf9XQF4_lxpXrWQpZUw.b['2'][0]++,this.get('error'))&&(__cov_U_Tkf9XQF4_lxpXrWQpZUw.b['2'][1]++,console.error(this.get('error')));__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['12']++;return;}else{__cov_U_Tkf9XQF4_lxpXrWQpZUw.b['1'][1]++;}__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['13']++;EDITOR_ID=this.editor._yuid;__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['14']++;var icon='echoIcon',json=this.get('ltiConfiguration'),ltiConfiguration=JSON.parse(json),iframeName='echo360-library-'+EDITOR_ID,iframe=document.createElement('iframe');__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['15']++;iframe.id=iframe.name=iframeName;__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['16']++;iframe.setAttribute('height','500px');__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['17']++;iframe.setAttribute('width','100%');__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['18']++;var form=document.createElement('form');__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['19']++;form.setAttribute('method','post');__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['20']++;form.setAttribute('id','echo360-form'+EDITOR_ID);__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['21']++;form.setAttribute('target',iframeName);__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['22']++;form.setAttribute('hidden','true');__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['23']++;form.action=ltiConfiguration.launch_url;__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['24']++;for(var property in ltiConfiguration){__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['25']++;if(ltiConfiguration.hasOwnProperty(property)){__cov_U_Tkf9XQF4_lxpXrWQpZUw.b['3'][0]++;__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['26']++;var input=document.createElement('input');__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['27']++;input.setAttribute('type','text');__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['28']++;input.setAttribute('value',ltiConfiguration[property]);__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['29']++;input.id=input.name=property;__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['30']++;form.appendChild(input);}else{__cov_U_Tkf9XQF4_lxpXrWQpZUw.b['3'][1]++;}}__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['31']++;document.body.appendChild(form);__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['32']++;var dialogue=this.getDialogue({headerContent:M.util.get_string('dialogtitle',COMPONENT_NAME),focusAfterHide:this.editor,width:800});__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['33']++;this._attachIframeToDialogue(dialogue,iframe,form);__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['34']++;this.addButton({icon:'ed/'+icon,iconComponent:'atto_echo360attoplugin',buttonName:icon,callback:this._doOpen,callbackArgs:null,name:ECHO360,tooltip:ECHO360});},_attachIframeToDialogue:function(dialogue,iframe,form){__cov_U_Tkf9XQF4_lxpXrWQpZUw.f['3']++;__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['35']++;dialogue.render();__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['36']++;dialogue.bodyNode.appendChild(iframe);__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['37']++;form.submit();__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['38']++;if(this._browserIsIE()){__cov_U_Tkf9XQF4_lxpXrWQpZUw.b['4'][0]++;__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['39']++;form.parentNode.removeChild(form);}else{__cov_U_Tkf9XQF4_lxpXrWQpZUw.b['4'][1]++;__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['40']++;form.remove();}},_doOpen:function(e){__cov_U_Tkf9XQF4_lxpXrWQpZUw.f['4']++;__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['41']++;e.preventDefault();__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['42']++;this._resetVariablesInScope();__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['43']++;EDITOR_INSTANCE={host:this.get('host'),editor:this.editor,dialogue:this.getDialogue()};__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['44']++;EDITOR_INSTANCE.dialogue.show();__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['45']++;if(!ADD_MESSAGE_HANDLER[EDITOR_ID]){__cov_U_Tkf9XQF4_lxpXrWQpZUw.b['5'][0]++;__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['46']++;window.addEventListener('message',function(e){__cov_U_Tkf9XQF4_lxpXrWQpZUw.f['5']++;__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['47']++;e.stopPropagation();__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['48']++;return this._receiveMessage(e);}.bind(this),true);}else{__cov_U_Tkf9XQF4_lxpXrWQpZUw.b['5'][1]++;}__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['49']++;ADD_MESSAGE_HANDLER[EDITOR_ID]=true;__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['50']++;this.markUpdated();},_receiveMessage:function(e){__cov_U_Tkf9XQF4_lxpXrWQpZUw.f['6']++;__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['51']++;if((__cov_U_Tkf9XQF4_lxpXrWQpZUw.b['7'][0]++,this._browserIsIE())||(__cov_U_Tkf9XQF4_lxpXrWQpZUw.b['7'][1]++,e.origin.includes(ECHO360))){__cov_U_Tkf9XQF4_lxpXrWQpZUw.b['6'][0]++;__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['52']++;MESSAGE_DATA=e.data;__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['53']++;if(MESSAGE_DATA){__cov_U_Tkf9XQF4_lxpXrWQpZUw.b['8'][0]++;__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['54']++;var queryParameters=this._getQueryParams();__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['55']++;if(queryParameters){__cov_U_Tkf9XQF4_lxpXrWQpZUw.b['9'][0]++;__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['56']++;switch(queryParameters.return_type){case'iframe':__cov_U_Tkf9XQF4_lxpXrWQpZUw.b['10'][0]++;__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['57']++;MEDIA='<iframe '+'src="'+queryParameters.url+'" height="'+queryParameters.height+'" width="'+queryParameters.width+'" title="'+queryParameters.title+'"></iframe> ';__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['58']++;break;case'url':__cov_U_Tkf9XQF4_lxpXrWQpZUw.b['10'][1]++;case'lti_launch_url':__cov_U_Tkf9XQF4_lxpXrWQpZUw.b['10'][2]++;__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['59']++;MEDIA='<a href="'+queryParameters.url+'" target="_blank">'+queryParameters.title+'</a> ';__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['60']++;break;default:__cov_U_Tkf9XQF4_lxpXrWQpZUw.b['10'][3]++;__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['61']++;console.error('Return type: '+queryParameters.return_type+' invalid');__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['62']++;this._resetVariablesInScope();}}else{__cov_U_Tkf9XQF4_lxpXrWQpZUw.b['9'][1]++;__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['63']++;console.error('No parameters returned from parsed message: '+MESSAGE_DATA);__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['64']++;this._resetVariablesInScope();}}else{__cov_U_Tkf9XQF4_lxpXrWQpZUw.b['8'][1]++;__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['65']++;console.error('No data returned from message: '+e);__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['66']++;this._resetVariablesInScope();}__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['67']++;this._doInsert();}else{__cov_U_Tkf9XQF4_lxpXrWQpZUw.b['6'][1]++;}},_getQueryParams:function(){__cov_U_Tkf9XQF4_lxpXrWQpZUw.f['7']++;__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['68']++;try{__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['69']++;var queryParams=JSON.parse('{"'+decodeURI(MESSAGE_DATA.split('?')[1]).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}');__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['70']++;if(!queryParams.hasOwnProperty('url')){__cov_U_Tkf9XQF4_lxpXrWQpZUw.b['11'][0]++;__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['71']++;console.error('Required parameter "url" missing from message: '+MESSAGE_DATA);__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['72']++;return null;}else{__cov_U_Tkf9XQF4_lxpXrWQpZUw.b['11'][1]++;__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['73']++;queryParams.url=decodeURIComponent(queryParams.url);}__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['74']++;queryParams.title=(__cov_U_Tkf9XQF4_lxpXrWQpZUw.b['12'][0]++,queryParams.title)||(__cov_U_Tkf9XQF4_lxpXrWQpZUw.b['12'][1]++,queryParams.url);__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['75']++;return queryParams;}catch(err){__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['76']++;console.error('Error caught while attempting to parse query parameters in message: '+MESSAGE_DATA+'\n'+err.message);__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['77']++;return null;}},_doInsert:function(){__cov_U_Tkf9XQF4_lxpXrWQpZUw.f['8']++;__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['78']++;EDITOR_INSTANCE.dialogue.hide();__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['79']++;if(!MEDIA){__cov_U_Tkf9XQF4_lxpXrWQpZUw.b['13'][0]++;__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['80']++;return;}else{__cov_U_Tkf9XQF4_lxpXrWQpZUw.b['13'][1]++;}__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['81']++;EDITOR_INSTANCE.editor.focus();__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['82']++;EDITOR_INSTANCE.host.insertContentAtFocusPoint(MEDIA);__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['83']++;this._resetVariablesInScope();__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['84']++;this.markUpdated();},_resetVariablesInScope:function(){__cov_U_Tkf9XQF4_lxpXrWQpZUw.f['9']++;__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['85']++;MEDIA=null;__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['86']++;MESSAGE_DATA=null;__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['87']++;EDITOR_INSTANCE={};},_browserIsIE:function(){__cov_U_Tkf9XQF4_lxpXrWQpZUw.f['10']++;__cov_U_Tkf9XQF4_lxpXrWQpZUw.s['88']++;return(__cov_U_Tkf9XQF4_lxpXrWQpZUw.b['14'][0]++,navigator.appName=='Microsoft Internet Explorer')||(__cov_U_Tkf9XQF4_lxpXrWQpZUw.b['14'][1]++,!!((__cov_U_Tkf9XQF4_lxpXrWQpZUw.b['15'][0]++,navigator.userAgent.match(/Trident/))||(__cov_U_Tkf9XQF4_lxpXrWQpZUw.b['15'][1]++,navigator.userAgent.match(/rv:11/))))||(__cov_U_Tkf9XQF4_lxpXrWQpZUw.b['14'][2]++,!!document.documentMode==true)||(__cov_U_Tkf9XQF4_lxpXrWQpZUw.b['14'][3]++,navigator.userAgent.indexOf('MSIE')!=-1);}},{ATTRS:{disabled:{value:false},usercontextid:{value:null},ltiConfiguration:{value:''}}});},'@VERSION@',{'requires':['moodle-editor_atto-plugin']});
