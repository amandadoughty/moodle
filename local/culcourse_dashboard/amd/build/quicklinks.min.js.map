{"version":3,"sources":["../src/quicklinks.js"],"names":["define","$","notification","templates","SELECTORS","QUICKLINK","EDITLINK","adminurl","changeVisibility","link","courseid","name","action","showhide","lnktxt","params","sesskey","M","cfg","post","done","data","span","parent","remove","render","html","js","appendNodeContents","fail","exception","hasClass","removeClass","addClass","err","jqXHR","status","error","getUrlParameter","url","replace","regex","RegExp","results","exec","decodeURIComponent","handleToggleVisibility","e","preventDefault","currentTarget","attr","match","init","body","delegate"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Helper functions for CUL Course Format\n *\n * @package    course/format\n * @subpackage cul\n * @copyright  2016 Amanda Doughty <amanda.doughty.1@city.ac.uk>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n *\n */\n\n/**\n  * @module local_culcourse_dashboard/quicklinks\n  */\ndefine(['jquery','core/notification', 'core/templates'], function($, notification, templates) {\n\n     /**\n      * Used CSS selectors\n      * @access private\n      */\n    var SELECTORS = {\n        QUICKLINK: 'a.dash-link',\n        EDITLINK: 'a.dashlinkedit',\n        };\n    var adminurl;\n\n    /**\n     * Perform the UI changes after server change\n     *\n     * @access private\n     * @method changeVisibility\n     * @param {jQuery node} link\n     * @param {int} courseid\n     * @param {string} name\n     * @param {int} value\n     */\n    var changeVisibility = function(link, courseid, name, action, showhide, lnktxt) {\n        var params = {\n            courseid: courseid,\n            name: name,\n            action: action,\n            showhide: showhide,\n            lnktxt: lnktxt,\n            sesskey: M.cfg.sesskey\n        };\n        $.post(adminurl, params, function() {})\n        .done(function(data) {\n            try {\n                var span = link.parent();\n                link.remove();\n\n                templates.render('local_culcourse_dashboard/editlink', data).done(function(html, js) {\n                    templates.appendNodeContents(span, html, js);\n                }).fail(notification.exception);\n\n                if(span.hasClass('linkhidden')) {\n                    span.removeClass('linkhidden');\n                } else {\n                    span.addClass('linkhidden');\n                }\n            }\n            catch(err) {\n                notification.exception(err);\n            }\n        })\n        .fail(function(jqXHR, status, error) {\n            notification.exception(error);\n        });\n    };\n\n    var getUrlParameter = function (url, name) {\n        name = name.replace(/[\\[]/, '\\\\[').replace(/[\\]]/, '\\\\]');\n        var regex = new RegExp('[\\\\?&]' + name + '=([^&#]*)');\n        var results = regex.exec(url);\n        return results === null ? '' : decodeURIComponent(results[1].replace(/\\+/g, ' '));\n    };\n\n    /**\n     * Prompts user when removing permission\n     *\n     * @access private\n     * @method handleRemoveRole\n     * @param {event} e\n     */\n    var handleToggleVisibility = function(e){\n        e.preventDefault();\n\n        var link = $(e.currentTarget);\n        var url = (link.attr('href'));\n        var courseid = getUrlParameter(url, 'courseid');\n        var name = getUrlParameter(url, 'name');\n        var action = getUrlParameter(url, 'action');\n        var showhide = getUrlParameter(url, 'showhide');\n        var lnktxt = link.attr('title');\n        lnktxt = lnktxt.match(/'([^']+)'/)[1];\n\n\n        changeVisibility(link, courseid, name, action, showhide, lnktxt);\n    };\n\n    return /** @alias module:local_culcourse_dashboard/quicklinks */ {\n        /**\n         * Initialize quicklinksmanager\n         * @access public\n         * @param {string} adminurl\n         */\n        init : function(url) {\n            adminurl = url;\n            var body = $('body');\n            body.delegate(SELECTORS.EDITLINK, 'click', handleToggleVisibility);\n        }\n    };\n});"],"file":"quicklinks.min.js"}