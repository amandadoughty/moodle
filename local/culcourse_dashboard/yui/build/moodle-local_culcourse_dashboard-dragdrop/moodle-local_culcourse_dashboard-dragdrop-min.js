YUI.add("moodle-local_culcourse_dashboard-dragdrop",function(e,t){var n={ACTIONAREA:"dash-edit",ACTIVITYLINK:"activitylink",ACTIVITYLINKCONTAINER:"activities-wrap",ACTIVITYLINKDRAGGABLE:"activitylinkdraggable",MOVE:"dash-move",QUICKLINK:"quicklink",QUICKLINKCONTAINER:"quicklinks-wrap",QUICKLINKDRAGGABLE:"quicklinkdraggable"},r=function(){r.superclass.constructor.apply(this,arguments)};e.extend(r,M.core.dragdrop,{goingLeft:null,isdragging:!1,initializer:function(){this.groups=[n.QUICKLINKDRAGGABLE],this.samenodeclass=n.QUICKLINK,this.parentnodeclass=n.QUICKLINKCONTAINER,this.samenodelabel={identifier:"afterlink",component:"local_culcourse_dashboard"},this.parentnodelabel={identifier:"totopoflinks",component:"local_culcourse_dashboard"},this.quicklinklistselector="."+n.QUICKLINK;if(e.Node.all(this.quicklinklistselector).size()){this.setup_for_quicklink(this.quicklinklistselector),this.samenodeclass=n.QUICKLINK,this.parentnodeclass=n.QUICKLINKCONTAINER;var t=new e.DD.Delegate({container:"."+n.QUICKLINKCONTAINER,nodes:"."+n.QUICKLINKDRAGGABLE,target:!0,handles:["."+n.MOVE],dragConfig:{groups:this.groups}});t.dd.plug(e.Plugin.DDProxy,{moveOnEnd:!1,cloneNode:!0}),t.dd.plug(e.Plugin.DDConstrained,{constrain:"."+n.QUICKLINKCONTAINER}),t.dd.plug(e.Plugin.DDWinScroll)}},setup_for_quicklink:function(t){e.Node.all(t).each(function(t){var r=t.getData("draggroups");r||(t.setAttribute("data-draggroups",this.groups.join(" ")),new e.DD.Drop({node:t,groups:this.groups,padding:"20 0 20 0"}));var i=t.one("a."+n.MOVE);if(i){var s=i.get("text");i.replace(this.get_drag_handle(s,n.MOVE,n.ICONCLASS,!0))}},this)},drag_start:function(e){var t=e.target;t.get("dragNode").set("innerHTML",t.get("node").get("innerHTML"))},drag_drag:function(e){this.isdragging=!0;var t=e.target,n=e.info;if(!this.in_group(t))return;n.offset[0]<0?this.absgoingleft=!0:n.offset[0]>0?this.absgoingleft=!1:this.absgoingleft=null,n.offset[1]>0?this.culabsgoingup=!1:n.offset[1]<0?this.culabsgoingup=!0:this.culabsgoingup=null,n.delta[0]<0?this.goingleft=!0:n.delta[0]>0&&(this.goingleft=!1)},drag_dropmiss:function(e){this.drop_hit(e)},drop_over:function(e){var t=e.drag.get("node"),n=e.drop.get("node");if(n.hasClass(this.samenodeclass)){var r;this.absgoingleft===!0?r="before":this.absgoingleft===!1&&(r="after"),this.culabsgoingup===!0?r="before":this.culabsgoingup===!1&&(r="after"),n.insert(t,r)}else(n.hasClass(this.parentnodeclass)||n.test('[data-droptarget="1"]'))&&!n.contains(t)&&(this.goingup?n.append(t):n.prepend(t))},drop_hit:function(t){var r=t.drop.get("node"),i=t.drag.get("node"),s={},o=i.one("."+n.ACTIONAREA),u=M.util.add_spinner(e,o);s.sesskey=M.cfg.sesskey,s.courseid=this.get("courseid"),s.moveto=r.getData("position"),s.copy=i.getData("position"),s.action=2,s.name=i.getData("setting"),s.keyboard=!this.isdragging;var a=M.cfg.wwwroot+this.get("ajaxurl");e.io(a,{method:"POST",data:s,on:{start:function(){u.show()},success:function(){window.setTimeout(function(){u.hide()},250)},failure:function(e,t){this.ajax_failure(t),u.hide()}},context:this})}},{NAME:"local_culcourse_dashboard_quicklinkdd",ATTRS:{courseid:{value:null},ajaxurl:{value:0},config:{value:0}}}),M.local_culcourse_dashboard=M.local_culcourse_dashboard||{},M.local_culcourse_dashboard.init_quicklinkdd=function(e){new r(e)};var i=function(){i.superclass.constructor.apply(this,arguments)};e.extend(i,M.core.dragdrop,{goingLeft:null,isdragging:!1,initializer:function(){this.groups=[n.ACTIVITYLINKDRAGGABLE],this.samenodeclass=n.ACTIVITYLINK,this.parentnodeclass=n.ACTIVITYLINKCONTAINER,this.samenodelabel={identifier:"afterlink",component:"local_culcourse_dashboard"},this.parentnodelabel={identifier:"totopoflinks",component:"local_culcourse_dashboard"},this.activitylinklistselector="."+n.ACTIVITYLINK;if(e.Node.all(this.activitylinklistselector).size()){this.setup_for_activitylink(this.activitylinklistselector);var t=new e.DD.Delegate({container:"."+n.ACTIVITYLINKCONTAINER,nodes:"."+n.ACTIVITYLINKDRAGGABLE,target:!0,handles:["."+n.MOVE],dragConfig:{groups:this.groups}});t.dd.plug(e.Plugin.DDProxy,{moveOnEnd:!1,cloneNode:!0}),t.dd.plug(e.Plugin.DDConstrained,{constrain:"."+n.ACTIVITYLINKCONTAINER}),t.dd.plug(e.Plugin.DDWinScroll)}},setup_for_activitylink:function(t){e.Node.all(t).each(function(t){var r=t.getData("draggroups");r||(t.setAttribute("data-draggroups",this.groups.join(" ")),new e.DD.Drop({node:t,groups:this.groups,padding:"20 0 20 0"}));var i=t.one("a."+n.MOVE);if(i){var s=i.get("text");i.replace(this.get_drag_handle(s,n.MOVE,n.ICONCLASS,!0))}},this)},drag_start:function(e){var t=e.target;t.get("dragNode").set("innerHTML",t.get("node").get("innerHTML"))},drag_drag:function(e){this.isdragging=!0;var t=e.target,n=e.info;if(!this.in_group(t))return;n.offset[0]<0?this.absgoingleft=!0:n.offset[0]>0?this.absgoingleft=!1:this.absgoingleft=null,n.offset[1]>0?this.culabsgoingup=!1:n.offset[1]<0?this.culabsgoingup=!0:this.culabsgoingup=null,n.delta[0]<0?this.goingleft=!0:n.delta[0]>0&&(this.goingleft=!1)},drag_dropmiss:function(e){this.drop_hit(e)},drop_over:function(e){var t=e.drag.get("node"),n=e.drop.get("node");if(n.hasClass(this.samenodeclass)){var r;this.absgoingleft===!0?r="before":this.absgoingleft===!1&&(r="after"),this.culabsgoingup===!0?r="before":this.culabsgoingup===!1&&(r="after"),n.insert(t,r)}else(n.hasClass(this.parentnodeclass)||n.test('[data-droptarget="1"]'))&&!n.contains(t)&&(this.goingup?n.append(t):n.prepend(t))},drop_hit:function(t){var r=t.drop.get("node"),i=t.drag.get("node"),s={},o=i.one("."+n.ACTIONAREA),u=M.util.add_spinner(e,o);s.sesskey=M.cfg.sesskey,s.courseid=this.get("courseid"),s.moveto=r.getData("position"),s.copy=i.getData("position"),s.action=2,s.name=i.getData("setting"),s.keyboard=!this.isdragging;var a=M.cfg.wwwroot+this.get("ajaxurl");e.io(a,{method:"POST",data:s,on:{start:function(){u.show()},success:function(){window.setTimeout(function(){u.hide()},250)},failure:function(e,t){this.ajax_failure(t),u.hide()}},context:this})}},{NAME:"local_culcourse_dashboard_activitylinkdd"
,ATTRS:{courseid:{value:null},ajaxurl:{value:0},config:{value:0}}}),M.local_culcourse_dashboard=M.local_culcourse_dashboard||{},M.local_culcourse_dashboard.init_activitylinkdd=function(e){new i(e)}},"@VERSION@",{requires:["base","node","io","dom","dd","dd-scroll","moodle-core-dragdrop","moodle-core-notification","moodle-course-coursebase","moodle-course-util"]});
