{"version":3,"sources":["../src/revised-grades-total-calculator.js"],"names":["revisedGradesTotalCalculator","tableSelector","tableNode","fieldNodes","find","totalNode","getRevisedTotal","total","each","i","field","node","value","parseFloat","val","replace","isNaN","updateTotal","loadedTotal","text","toFixed","on"],"mappings":"sKAuBA,uDAOA,QAASA,CAAAA,CAAT,CAAsCC,CAAtC,CAAqD,IAC3CC,CAAAA,CAAS,CAAG,cAAED,CAAF,CAD+B,CAE3CE,CAAU,CAAGD,CAAS,CAACE,IAAV,CAAe,yBAAf,CAF8B,CAG3CC,CAAS,CAAGH,CAAS,CAACE,IAAV,CAAe,sBAAf,CAH+B,CAM3CE,CAAe,CAAG,UAAM,CAC1B,GAAIC,CAAAA,CAAK,CAAG,IAAZ,CACAJ,CAAU,CAACK,IAAX,CAAgB,SAASC,CAAT,CAAYC,CAAZ,CAAmB,IACzBC,CAAAA,CAAI,CAAG,cAAED,CAAF,CADkB,CAEzBE,CAAK,CAAGC,UAAU,CAACF,CAAI,CAACG,GAAL,GAAWC,OAAX,CAAmB,GAAnB,CAAwB,GAAxB,CAAD,CAFO,CAG/B,GAAI,CAACH,CAAD,EAAUI,KAAK,CAACJ,CAAD,CAAnB,CAA4B,CACxB,MACH,CACDL,CAAK,CAAG,CAACA,CAAK,EAAI,CAAV,EAAeK,CAC1B,CAPD,EAQA,MAAOL,CAAAA,CACV,CAjBgD,CAmB3CU,CAAW,CAAG,UAAM,CACtB,GAAMC,CAAAA,CAAW,CAAGZ,CAAe,EAAnC,CACA,GAAoB,IAAhB,GAAAY,CAAJ,CAA0B,CACtBb,CAAS,CAACc,IAAV,CAAeD,CAAW,CAACE,OAAZ,CAAoB,CAApB,CAAf,CACH,CAFD,IAEO,CACHf,CAAS,CAACc,IAAV,CAAe,EAAf,CACH,CACJ,CA1BgD,CA4BjDhB,CAAU,CAACkB,EAAX,CAAc,QAAd,CAAwB,UAAW,CAC/BJ,CAAW,EACd,CAFD,EAIAA,CAAW,EACd,C,OAEmBjB,C","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Revised grades total calculator.\n *\n * @copyright  2019 Coventry University\n * @author     Frédéric Massart <fred@branchup.tech>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport $ from 'jquery';\n\n/**\n * Revised grades total calculator.\n *\n * @param {String} tableSelector The table selector.\n */\nfunction revisedGradesTotalCalculator(tableSelector) {\n    const tableNode = $(tableSelector);\n    const fieldNodes = tableNode.find('input[name^=\"grade_\"]');\n    const totalNode = tableNode.find('.total-revised-grade');\n\n\n    const getRevisedTotal = () => {\n        let total = null;\n        fieldNodes.each(function(i, field) {\n            const node = $(field);\n            const value = parseFloat(node.val().replace(',', '.')); // Minor handling of formatted values.\n            if (!value || isNaN(value)) {\n                return;\n            }\n            total = (total || 0) + value;\n        });\n        return total;\n    };\n\n    const updateTotal = () => {\n        const loadedTotal = getRevisedTotal();\n        if (loadedTotal !== null) {\n            totalNode.text(loadedTotal.toFixed(2));\n        } else {\n            totalNode.text('');\n        }\n    };\n\n    fieldNodes.on('change', function() {\n        updateTotal();\n    });\n\n    updateTotal();\n}\n\nexport const init = revisedGradesTotalCalculator;\n"],"file":"revised-grades-total-calculator.min.js"}