define ("qtype_essayautograde/essayautograde",["jquery","core/str"],function(a,b){var c={plugin:"qtype_essayautograde",str:{},itemtype:"",itemmatch:"",editortype:"",editormaxtries:50,editorinterval:100,responsesample:"",responseoriginal:""};c.init=function(a,b,d,e){var f="";switch(b){case"chars":f=".";break;case"words":f="\\w+";break;case"sentences":f="[^\\.?!]+[\\.?!]";break;case"paragraphs":f="[^\\r\\n]+[\\r\\n]*";break;}c.itemtype=b;c.itemmatch=new RegExp(f,"g");c.editortype=d;if(a){c.setup_response_heights()}else{c.setup_itemcounts();c.setup_responsesample(e)}};c.setup_response_heights=function(){a("textarea.qtype_essay_response").each(function(){a(this).height(1);a(this).height(this.scrollHeight)})};c.setup_itemcounts=function(){a(".qtype_essay_response").each(function(){var b=c.get_itemcount_id(this),d=a.Deferred();c.check_editor(this,d);a.when(d).done(a.proxy(function(){c.create_itemcount(this,b);c.setup_itemcount(this,b)},this,b))})};c.check_editor=function(b,d){var e="";switch(c.editortype){case"atto":e="[contenteditable=true]";break;case"tinymce":e="iframe";break;}if(""==e){d.resolve()}else{var f=setInterval(function(){if(a(b).find(e).length){clearInterval(f);d.resolve()}},c.editorinterval)}};c.create_itemcount=function(a,b){if(null===document.getElementById(b)){var c=document.createElement("P");c.setAttribute("id",b);c.setAttribute("class","itemcount");a.parentNode.insertBefore(c,a.nextSibling)}};c.setup_itemcount=function(b,d){var e=c.get_editable_element(b);if(e){a(e).keyup(function(){c.show_itemcount(this,d)});c.show_itemcount(e,d)}};c.get_editable_element=function(b){if("TEXTAREA"==a(b).prop("tagName")){return b}var c=a(b).find("[contenteditable=true]");if(c.length){return c.get(0)}var e=b.getElementsByTagName("IFRAME");if(e.length){e=e[0];var f=e.contentWindow||e.contentDocument;if(f.document){f=f.document}if(f.body&&f.body.isContentEditable){return f.body}}var c=a(b).find("textarea");if(c.length){return c.get(0)}return null};c.get_textarea=function(b){if("TEXTAREA"==a(b).prop("tagName")){return b}return a(b).find("textarea").get(0)};c.get_textarea_name=function(b){var d=c.get_textarea(b);return a(d).attr("name")};c.get_itemcount_id=function(a){var b=c.get_textarea_name(a);return"id_"+b+"_itemcount"};c.escape=function(a){var b=/(:|\.|\[|\]|,|=|@)/g;return"#"+a.replace(b,"\\$1")};c.show_itemcount=function(d,e){if("TEXTAREA"==a(d).prop("tagName")){var f=a(d).val().match(c.itemmatch)}else{var f=a(d).text().match(c.itemmatch)}if(f){f=f.length}else{f=0}b.get_strings([{key:c.itemtype,component:c.plugin}]).done(function(b){a(c.escape(e)).text(b[0]+": "+f)})};c.setup_responsesample=function(d){if(""==d){return}c.responsesample=d;b.get_strings([{key:"hidesample",component:c.plugin},{key:"showsample",component:c.plugin}]).done(function(b){c.str.hidesample=b[0];c.str.showsample=b[1];var d=a(".qtext").find("p:not(:empty), div:not(:empty)");if(d.length){d=d.last()}else{d=a(".qtext")}d.append(a("<span></span>").click(function(){var b="",d="",e=!1;if(a(this).hasClass("showsample")){a(this).removeClass("showsample").addClass("hidesample").text(c.str.hidesample);b=c.responsesample;e=!0}else{a(this).removeClass("hidesample").addClass("showsample").text(c.str.showsample);b=c.responseoriginal}var f=null,g=a(this).closest(".qtext");if("audio"==c.editortype||"video"==c.editortype){f=g.find(".audiovideo_response_prompt")}else{var h=g.next(".ablock").find(".answer .qtype_essay_response");if(h.is("[name$='_answer']")){f=h}else{f=h.find("[contenteditable=true]");if(0==f.length){f=h.find("iframe").contents().find("[contenteditable=true]");if(0==f.length){f=h.find("[name$='_answer']")}}}}if(null===f||0==f.length){return!1}if("TEXTAREA"==f.prop("tagName")){d=f.val();f.val(b).keyup()}else{d=f.text();f.text(b).keyup()}if(e){c.responseoriginal=d}return!0}).trigger("click"))})};return c});
//# sourceMappingURL=essayautograde.min.js.map
