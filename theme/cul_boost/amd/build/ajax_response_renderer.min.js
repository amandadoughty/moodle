define(["jquery","core/templates","core/notification","core/url"],function(m,u,C,y){var _={ACTIVITY:40,RESOURCE:50};return{render:function(a,e){var t,n;e.children&&e.children.length?(function p(a,e){var h=m("<ul></ul>");h.attr("role","group"),h.attr("aria-hidden",!0),m.each(e,function(a,e){var t,n,r,i,d,l,o,c,s;"object"==typeof e&&(t=m("<li></li>"),n=m("<p></p>"),r=e.id||e.key+"_tree_item",i="theme_cul_boost_label_"+e.key+"_"+a,d=null,l=!(!e.expandable&&!e.haschildren),n.addClass("tree_item"),n.attr("id",r),n.attr("role","treeitem"),n.attr("tabindex","-1"),t.attr("aria-labelledby",i),e.requiresajaxloading&&(n.attr("data-requires-ajax",!0),n.attr("data-node-id",e.id),n.attr("data-node-key",e.key),n.attr("data-node-type",e.type)),l&&(t.addClass("collapsed contains_branch"),n.attr("aria-expanded",!1),n.addClass("branch")),c=null,e.link?(o=m('<a title="'+e.title+'" href="'+e.link+'"></a>'),(c=o).append('<span id="'+i+'" class="item-content-wrap">'+e.name+"</span>"),e.hidden&&o.addClass("dimmed"),n.append(o)):(s=m("<span></span>"),(c=s).append('<span id="'+i+' class="item-content-wrap">'+e.name+"</span>"),e.hidden&&s.addClass("dimmed"),n.append(s)),!e.icon||l&&e.type!==_.ACTIVITY&&e.type!==_.RESOURCE||(t.addClass("item_with_icon"),n.addClass("hasicon"),e.type===_.ACTIVITY||e.type===_.RESOURCE?((d=m("<img/>")).attr("alt",e.icon.alt),d.attr("title",e.icon.title),d.attr("src",y.imageUrl(e.icon.pix,e.icon.component)),m.each(e.icon.classes,function(a,e){d.addClass(e)}),c.prepend(d)):("moodle"==e.icon.component&&(e.icon.component="core"),u.renderPix(e.icon.pix,e.icon.component,e.icon.title).then(function(a){c.prepend(a)}).catch(C.exception))),t.append(n),h.append(t),e.children&&e.children.length?p(n,e.children):l&&!e.requiresajaxloading&&(t.removeClass("contains_branch"),n.addClass("emptybranch")))}),a.parent().append(h);var t=a.attr("id")+"_group";h.attr("id",t),a.attr("aria-owns",t),a.attr("role","treeitem")}(a,e.children),t=a.children("[role='treeitem']").first(),n=a.find("#"+t.attr("aria-owns")),t.attr("aria-expanded",!0),n.attr("aria-hidden",!1)):a.parent().hasClass("contains_branch")&&(a.parent().removeClass("contains_branch"),a.addClass("emptybranch"))}}});