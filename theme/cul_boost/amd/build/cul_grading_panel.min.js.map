{"version":3,"sources":["../src/cul_grading_panel.js"],"names":["define","$","Y","notification","templates","fragment","ajax","str","GradingPanel","prototype","_nicePrependGradeAlertContents","node","html","js","promise","Deferred","fadeOut","prependNodeContents","fadeIn","resolve","_gradeHiddenAlert","contextid","_region","attr","assignmentid","courseid","gradingform","window","M","util","js_pending","_lastUserId","params","userid","attemptnumber","_lastAttemptNumber","assignid","loadFragment","done","js_complete","bind","fail","exception","registerMoreEventListeners","docElement","document","on"],"mappings":"AAyBAA,OAAM,qCAAC,CAAC,QAAD,CAAW,UAAX,CAAuB,mBAAvB,CAA4C,gBAA5C,CAA8D,eAA9D,CACC,WADD,CACc,UADd,CAC0B,0BAD1B,CAAD,CAEC,SAASC,CAAT,CAAYC,CAAZ,CAAeC,CAAf,CAA6BC,CAA7B,CAAwCC,CAAxC,CAAkDC,CAAlD,CAAwDC,CAAxD,CAA6DC,CAA7D,CAA2E,CAY9EA,CAAY,CAACC,SAAb,CAAuBC,8BAAvB,CAAwD,SAASC,CAAT,CAAeC,CAAf,CAAqBC,CAArB,CAAyB,CAC7E,GAAIC,CAAAA,CAAO,CAAGb,CAAC,CAACc,QAAF,EAAd,CAEAJ,CAAI,CAACK,OAAL,CAAa,MAAb,CAAqB,UAAW,CAC5BZ,CAAS,CAACa,mBAAV,CAA8BN,CAA9B,CAAoCC,CAApC,CAA0CC,CAA1C,EACAF,CAAI,CAACO,MAAL,CAAY,MAAZ,CAAoB,UAAW,CAC3BJ,CAAO,CAACK,OAAR,EACH,CAFD,CAGH,CALD,EAOA,MAAOL,CAAAA,CAAO,CAACA,OAAR,EACV,CAXD,CAmBAN,CAAY,CAACC,SAAb,CAAuBW,iBAAvB,CAA2C,UAAW,IAC9CC,CAAAA,CAAS,CAAG,KAAKC,OAAL,CAAaC,IAAb,CAAkB,gBAAlB,CADkC,CAE9CC,CAAY,CAAG,KAAKF,OAAL,CAAaC,IAAb,CAAkB,mBAAlB,CAF+B,CAG9CE,CAAQ,CAAGxB,CAAC,CAAC,4CAAD,CAAD,CAA8CsB,IAA9C,CAAmD,eAAnD,CAHmC,CAI9CG,CAAW,CAAGzB,CAAC,CAAC,cAAD,CAJ+B,CAOlD0B,MAAM,CAACC,CAAP,CAASC,IAAT,CAAcC,UAAd,CAAyB,qCAAzB,EAGA,GAAuB,CAAnB,MAAKC,WAAT,CAA0B,CAEtB,GAAIC,CAAAA,CAAM,CAAG,CACTC,MAAM,CAAE,KAAKF,WADJ,CAETG,aAAa,CAAE,KAAKC,kBAFX,CAGTC,QAAQ,CAAEZ,CAHD,CAITC,QAAQ,CAAEA,CAJD,CAAb,CAOApB,CAAQ,CAACgC,YAAT,CAAsB,iBAAtB,CAAyC,YAAzC,CAAuDhB,CAAvD,CAAkEW,CAAlE,EAA0EM,IAA1E,CAA+E,SAAS1B,CAAT,CAAeC,CAAf,CAAmB,CAC9F,KAAKH,8BAAL,CAAoCgB,CAApC,CAAiDd,CAAjD,CAAuDC,CAAvD,EACCyB,IADD,CACM,UAAW,CAEbX,MAAM,CAACC,CAAP,CAASC,IAAT,CAAcU,WAAd,CAA0B,qCAA1B,CACH,CAHK,CAGJC,IAHI,CAGC,IAHD,CADN,EAKCC,IALD,CAKMtC,CAAY,CAACuC,SALnB,CAMH,CAP8E,CAO7EF,IAP6E,CAOxE,IAPwE,CAA/E,EAOcC,IAPd,CAOmBtC,CAAY,CAACuC,SAPhC,CAQH,CAjBD,IAiBO,CAEHf,MAAM,CAACC,CAAP,CAASC,IAAT,CAAcU,WAAd,CAA0B,qCAA1B,CACH,CACJ,CA/BD,CAsCA/B,CAAY,CAACC,SAAb,CAAuBkC,0BAAvB,CAAoD,UAAW,CAC3D,GAAIC,CAAAA,CAAU,CAAG3C,CAAC,CAAC4C,QAAD,CAAlB,CACAD,CAAU,CAACE,EAAX,CAAc,qBAAd,CAAqC,KAAK1B,iBAAL,CAAuBoB,IAAvB,CAA4B,IAA5B,CAArC,CACH,CAHD,CAKA,MAAOhC,CAAAA,CACV,CA7EK,CAAN","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript controller for the \"Grading\" panel at the right of the page.\n *\n * @module     theme_cul_boost/grading_panel\n * @package    theme_cul_boost\n * @class      GradingPanel\n * @copyright  2017 Amanda Doughty\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @since      3.2\n */\ndefine(['jquery', 'core/yui', 'core/notification', 'core/templates', 'core/fragment',\n        'core/ajax', 'core/str', 'mod_assign/grading_panel'],\n       function($, Y, notification, templates, fragment, ajax, str, GradingPanel) {\n\n    /**\n     * Update the grade alert.\n     *\n     * @private\n     * @method _nicePrependGradeAlertContents\n     * @param {JQuery} node\n     * @param {String} html\n     * @param {String} js\n     * @return {Deferred} promise resolved when the animations are complete.\n     */\n    GradingPanel.prototype._nicePrependGradeAlertContents = function(node, html, js) {\n        var promise = $.Deferred();\n\n        node.fadeOut(\"fast\", function() {\n            templates.prependNodeContents(node, html, js);\n            node.fadeIn(\"fast\", function() {\n                promise.resolve();\n            });\n        });\n\n        return promise.promise();\n    };\n\n    /**\n     * Add an alert indicating whether or not the grade is hidden in the gradebook.\n     *\n     * @private\n     * @method _gradeHiddenAlert\n     */\n    GradingPanel.prototype._gradeHiddenAlert = function() {\n        var contextid = this._region.attr('data-contextid');\n        var assignmentid = this._region.attr('data-assignmentid');\n        var courseid = $('[data-region=\"grading-navigation-panel\"]').attr('data-courseid');\n        var gradingform = $('.gradingform');\n\n        // Tell behat to back off too.\n        window.M.util.js_pending('theme-cul_boost-loading-grade-alert');\n\n        // Update the page.\n        if (this._lastUserId > 0) {\n            // Reload the grading form \"fragment\" for this user.\n            var params = {\n                userid: this._lastUserId,\n                attemptnumber: this._lastAttemptNumber,\n                assignid: assignmentid,\n                courseid: courseid\n            };\n\n            fragment.loadFragment('theme_cul_boost', 'gradealert', contextid, params).done(function(html, js) {\n                this._nicePrependGradeAlertContents(gradingform, html, js)\n                .done(function() {\n                    // Tell behat we are friends again.\n                    window.M.util.js_complete('theme-cul_boost-loading-grade-alert');\n                }.bind(this))\n                .fail(notification.exception);\n            }.bind(this)).fail(notification.exception);\n        } else {\n            // Tell behat we are friends again.\n            window.M.util.js_complete('theme-cul_boost-loading-grade-alert');\n        }\n    };\n\n    /**\n     * Register more event listeners for the grade panel.\n     *\n     * @method registerMoreEventListeners\n     */\n    GradingPanel.prototype.registerMoreEventListeners = function() {\n        var docElement = $(document);\n        docElement.on('finish-loading-user', this._gradeHiddenAlert.bind(this));\n    };\n\n    return GradingPanel;\n});\n"],"file":"cul_grading_panel.min.js"}