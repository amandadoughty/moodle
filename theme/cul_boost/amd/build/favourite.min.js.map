{"version":3,"sources":["../src/favourite.js"],"names":["define","$","ajax","templates","notification","str","url","Y","PubSub","CourseEvents","MyOverview","StarredCourses","editlink","editfavourite","e","preventDefault","href","target","get","split","querystring","use","io","M","cfg","wwwroot","method","context","data","on","success","id","JSON","parse","responseText","link","one","newurl","replace","action","newaction","setAttribute","text","toggleClass","set","end","fire","roots","each","node","init","publish","broadcast"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * A javascript module to ...\n *\n * @package    theme_cul_boost\n * @copyright  2019 Amanda Doughty\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/ajax', 'core/templates', 'core/notification', 'core/str', \n    'core/url', 'core/yui', 'core/pubsub', 'core_course/events', \n    'block_myoverview/main', 'block_starredcourses/main'],\n    function($, ajax, templates, notification, str, url, Y, PubSub, CourseEvents,\n        MyOverview, StarredCourses) {\n\n    \"use strict\";\n    var editlink = null;\n    \n    var editfavourite = function (e) {\n        e.preventDefault();\n\n        var href = e.target.get('href').split('?');\n        var url = href[0];\n        var querystring = href[1];\n\n        Y.use('node', 'querystring-parse', 'json-parse', function() {\n            Y.io(M.cfg.wwwroot+'/theme/cul_boost/favourite_ajax.php', {\n                method: 'POST',\n                context: this,\n                data: querystring,\n                on: {\n                    success: function(id, e) {\n                        var data = Y.JSON.parse(e.responseText);\n                        var link = editlink.one('a');\n                        var newurl = url + '?' + querystring.replace(data.action, data.newaction);\n                        link.setAttribute('data-content', data.text);\n                        link.toggleClass('favourited');\n                        link.set('href', newurl);\n                    },\n                    end: function() {\n                        Y.fire('culcourse-listing:update-favourites');\n\n                        var roots = $('.block_myoverview .block-myoverview');\n                        $.each(roots, function(id, node) {\n                            MyOverview.init(node);\n                        });\n\n                        roots = $('.block_starredcourses .block-starredcourses');\n                        $.each(roots, function(id, node) {\n                            StarredCourses.init(node);\n                        });\n                    }\n                }\n            });\n        });\n    };\n\n    return {\n        init: function () {            \n            if (Y.one('#theme-cul_boost-removefromfavourites')) {\n                editlink = Y.one('#theme-cul_boost-removefromfavourites');\n                editlink.on('click', editfavourite, this);\n            }\n            else if (Y.one('#theme-cul_boost-addtofavourites')) {\n                editlink = Y.one('#theme-cul_boost-addtofavourites');\n                editlink.on('click', editfavourite, this);\n            }\n\n            Y.publish('culcourse-listing:update-favourites', {\n                broadcast:2\n            });\n        }\n    };\n});\n"],"file":"favourite.min.js"}