define(["jquery","core/custom_interaction_events","core/notification","core/pubsub","core/paged_content_paging_bar","core/templates","core_course/events","core_course/repository"],function(i,t,o,r,u,s,c,n){function d(e){return n.getLastAccessedCourses(e,10).then(function(e){return t=e,n=i(v).data("displaycoursecategory"),a=t.map(function(e){return e.showcoursecategory=n,s.render("block_recentlyaccessedcourses/course-card",e)}),i.when.apply(null,a).then(function(){var t=[];return a.forEach(function(e){e.then(function(e){t.push(i(e))}).catch(o.exception)}),t});var t,n,a})}function l(e){var t=e.find(b).find(h),n=parseFloat(t.outerWidth()),a=j.length,i=0;E||(t.html(j[0]),E=j[0].outerWidth(!0)),k=Math.floor(n/E),i=B+k<a?B:0<=(i=B-(B+k-a))?i:0;var o,r,s=j.slice(i,i+k),c=s.reduce(function(e,t){return e+t.attr("data-course-id")},"");if(j.length>s.length?(t.addClass("justify-content-center"),t.removeClass("justify-content-start")):(t.removeClass("justify-content-center"),t.addClass("justify-content-start")),x!=c){var d=e.find(u.rootSelector);t.html(s),x=c,k>=j.length?((r=e.find(y)).css("opacity",0),r.css("visibility","hidden"),r.attr("aria-hidden","true")):((o=e.find(y)).css("opacity",1),o.css("visibility","visible"),o.attr("aria-hidden","false"),0===B?u.disablePreviousControlButtons(d):u.enablePreviousControlButtons(d),B+k>=j.length?u.disableNextControlButtons(d):u.enableNextControlButtons(d))}}function f(n){var e=null,a=!1;r.subscribe(c.favourited,function(e){var t;t=e,j.forEach(function(e){e.attr("data-course-id")==t&&e.find(g).removeClass("hidden")})}),r.subscribe(c.unfavorited,function(e){var t;t=e,j.forEach(function(e){e.attr("data-course-id")==t&&e.find(g).addClass("hidden")})}),r.subscribe("nav-drawer-toggle-start",function(){if(w&&j.length&&!a){a=!0;var e=0,t=function(){setTimeout(function(){l(n),++e<5&&a&&t()},100)};t(n)}}),r.subscribe("nav-drawer-toggle-end",function(){a=!1}),i(window).on("resize",function(){w&&j.length&&(e=e||setTimeout(function(){e=null,l(n)},66))}),t.define(n,[t.events.activate]),n.on(t.events.activate,m,function(e,t){i(e.target).closest(m).hasClass("disabled")||(B+=k,l(n)),t.originalEvent.preventDefault()}),n.on(t.events.activate,_,function(e,t){i(e.target).closest(_).hasClass("disabled")||(B=(B-=k)<0?0:B,l(n)),t.originalEvent.preventDefault()})}var v='[data-region="recentlyaccessedcourses"]',h='[data-region="card-deck"]',g='[data-region="is-favourite"]',b='[data-region="view-content"]',p='[data-region="empty-message"]',C='[data-region="loading-placeholder"]',y='[data-region="paging-bar"]',m='[data-control="next"]',_='[data-control="previous"]',w=!1,j=[],x=null,E=null,B=0,k=1;return{init:function(e,a){a=i(a),f(a),d(e).then(function(e){var t,n;w=!0,(j=e).length?((n=a).find(b).removeClass("hidden"),n.find(p).addClass("hidden"),n.find(C).addClass("hidden"),l(a)):((t=a).find(p).removeClass("hidden"),t.find(C).addClass("hidden"),t.find(b).addClass("hidden"))}).catch(o.exception)}}});