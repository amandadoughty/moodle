define(["jquery","core/custom_interaction_events","core/notification","core/pubsub","core/paged_content_paging_bar","core/templates","core_course/events","core_course/repository"],function(a,e,i,o,c,r,s,n){function d(t){return n.getLastAccessedCourses(t,10).then(function(t){return function(t){var e=a(f).data("displaycoursecategory"),n=t.map(function(t){return t.showcoursecategory=e,r.render("block_recentlyaccessedcourses/course-card",t)});return a.when.apply(null,n).then(function(){var e=[];return n.forEach(function(t){t.then(function(t){e.push(a(t))}).catch(i.exception)}),e})}(t)})}function u(t){var e=t.find(g).find(h),n=parseFloat(e.outerWidth()),i=w.length,a=0;x||(e.html(w[0]),x=w[0].outerWidth(!0)),B=Math.floor(n/x),a=E+B<i?E:0<=(a=E-(E+B-i))?a:0;var o=w.slice(a,a+B),r=o.reduce(function(t,e){return t+e.attr("data-course-id")},"");if(w.length>o.length?(e.addClass("justify-content-center"),e.removeClass("justify-content-start")):(e.removeClass("justify-content-center"),e.addClass("justify-content-start")),j!=r){var s=t.find(c.rootSelector);e.html(o),j=r,B>=w.length?function(t){var e=t.find(C);e.css("opacity",0),e.css("visibility","hidden"),e.attr("aria-hidden","true")}(t):(function(t){var e=t.find(C);e.css("opacity",1),e.css("visibility","visible"),e.attr("aria-hidden","false")}(t),0===E?c.disablePreviousControlButtons(s):c.enablePreviousControlButtons(s),E+B>=w.length?c.disableNextControlButtons(s):c.enableNextControlButtons(s))}}function l(n){var t=null,i=!1;o.subscribe(s.favourited,function(t){!function(t,e){w.forEach(function(t){t.attr("data-course-id")==e&&t.find(v).removeClass("hidden")})}(0,t)}),o.subscribe(s.unfavorited,function(t){!function(t,e){w.forEach(function(t){t.attr("data-course-id")==e&&t.find(v).addClass("hidden")})}(0,t)}),o.subscribe("nav-drawer-toggle-start",function(){if(_&&w.length&&!i){i=!0;var t=0,e=function(){setTimeout(function(){u(n),++t<5&&i&&e()},100)};e(n)}}),o.subscribe("nav-drawer-toggle-end",function(){i=!1}),a(window).on("resize",function(){_&&w.length&&(t=t||setTimeout(function(){t=null,u(n)},66))}),e.define(n,[e.events.activate]),n.on(e.events.activate,y,function(t,e){a(t.target).closest(y).hasClass("disabled")||(E+=B,u(n)),e.originalEvent.preventDefault()}),n.on(e.events.activate,m,function(t,e){a(t.target).closest(m).hasClass("disabled")||(E=(E-=B)<0?0:E,u(n)),e.originalEvent.preventDefault()})}var f='[data-region="recentlyaccessedcourses"]',h='[data-region="card-deck"]',v='[data-region="is-favourite"]',g='[data-region="view-content"]',b='[data-region="empty-message"]',p='[data-region="loading-placeholder"]',C='[data-region="paging-bar"]',y='[data-control="next"]',m='[data-control="previous"]',_=!1,w=[],j=null,x=null,E=0,B=1;return{init:function(t,e){e=a(e),l(e),d(t).then(function(t){_=!0,(w=t).length?(function(t){t.find(g).removeClass("hidden"),t.find(b).addClass("hidden"),t.find(p).addClass("hidden")}(e),u(e)):function(t){t.find(b).removeClass("hidden"),t.find(p).addClass("hidden"),t.find(g).addClass("hidden")}(e)}).catch(i.exception)}}});