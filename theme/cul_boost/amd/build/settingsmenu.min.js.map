{"version":3,"sources":["../src/settingsmenu.js"],"names":["define","$","init","siteAdminNodeId","siteAdminNode","siteAdminLink","children","first","attr","settingsblock","document","ajaxComplete","css","branch","blocktree","width","outerWidth","sibling","siblings","maxheight","element","each","outerHeight","height","closenav","e","rootnode","hasClass","find","sib","parent","level","parents","length","fix_width","openbranch","branches","on","addClass","scrollto","animate","scrollTop","offset","top","removeClass","keyup","keyCode"],"mappings":"AACAA,OAAM,gCAAC,CAAC,QAAD,CAAW,UAAX,CAAuB,WAAvB,CAAD,CAAsC,SAASC,CAAT,CAAuB,CAC/D,MAAO,CACHC,IAAI,CAAE,cAASC,CAAT,CAA0B,IAExBC,CAAAA,CAAa,CAAGH,CAAC,CAAC,IAAME,CAAP,CAFO,CAGxBE,CAAa,CAAGD,CAAa,CAACE,QAAd,CAAuB,MAAvB,EAA+BC,KAA/B,EAHQ,CAI5BF,CAAa,CAACG,IAAd,CAAmB,UAAnB,CAA+B,CAA/B,EAGA,GAAIC,CAAAA,CAAa,CAAGR,CAAC,CAAC,4BAAD,CAArB,CAIAA,CAAC,CAACS,QAAD,CAAD,CAAYC,YAAZ,CAAyB,UAA+B,CAQpDF,CAAa,CAACG,GAAd,CAAkB,SAAlB,CAA6B,OAA7B,EARoD,GAWhDC,CAAAA,CAAM,CAAGZ,CAAC,CAAC,mBAAD,CAXsC,CAYhDa,CAAS,CAAGb,CAAC,CAAC,kBAAD,CAZmC,CAahDc,CAAK,CAAGD,CAAS,CAACE,UAAV,EAbwC,CAchDC,CAAO,CAAGJ,CAAM,CAACK,QAAP,CAAgB,IAAhB,CAdsC,CAiBpD,QAASC,CAAAA,CAAT,CAAmBC,CAAnB,CAA4B,CACxB,GAAID,CAAAA,CAAS,CAAG,CAAhB,CACAC,CAAO,CAACC,IAAR,CAAa,UAAW,CACpBF,CAAS,CAAIlB,CAAC,CAAC,IAAD,CAAD,CAAQqB,WAAR,GAAwBH,CAAxB,CAAoClB,CAAC,CAAC,IAAD,CAAD,CAAQsB,MAAR,EAApC,CAAuDJ,CACvE,CAFD,EAGAC,CAAO,CAACG,MAAR,CAAeJ,CAAf,EACAL,CAAS,CAACS,MAAV,CAAiBJ,CAAjB,CACH,CAID,QAASK,CAAAA,CAAT,CAAkBC,CAAlB,CAAqB,IACbC,CAAAA,CAAQ,CAAGD,CAAC,CAACE,QAAF,CAAW,WAAX,CADE,CAEbrB,CAAQ,CAAGmB,CAAC,CAACP,QAAF,CAAW,IAAX,EAAiBU,IAAjB,CAAsB,mBAAtB,CAFE,CAGbC,CAAG,CAAGJ,CAAC,CAACK,MAAF,GAAWZ,QAAX,EAHO,CAIba,CAAK,CAA4C,CAAzC,CAAAN,CAAC,CAACO,OAAF,CAAU,oBAAV,EAAgCC,MAJ3B,CAMjB,GAA+B,MAA3B,EAAAR,CAAC,CAACjB,IAAF,CAAO,eAAP,CAAJ,CAAuC,CACnCuB,CAAK,CAAGA,CAAK,CAAG,CACnB,CAEDzB,CAAQ,CAACE,IAAT,CAAc,eAAd,CAA+B,OAA/B,EACAF,CAAQ,CAACY,QAAT,CAAkB,IAAlB,EAAwBV,IAAxB,CAA6B,aAA7B,CAA4C,MAA5C,EACAqB,CAAG,CAACD,IAAJ,CAAS,mBAAT,EAA8BpB,IAA9B,CAAmC,eAAnC,CAAoD,OAApD,EACAqB,CAAG,CAACD,IAAJ,CAAS,mBAAT,EAA8BV,QAA9B,CAAuC,IAAvC,EAA6CV,IAA7C,CAAkD,aAAlD,CAAiE,MAAjE,EAEAM,CAAS,CAACF,GAAV,CAAc,OAAd,CAAuB,QAAUG,CAAV,CAAkB,OAAlB,CAA4BgB,CAA5B,CAAoC,KAA3D,CACH,CAED,QAASG,CAAAA,CAAT,EAAqB,IACbC,CAAAA,CAAU,CAAGlC,CAAC,CAAC,2CAAD,CADD,CAEbmC,CAAQ,CAAuB,CAApB,CAAAD,CAAU,CAACF,MAFT,CAGjBnB,CAAS,CAACF,GAAV,CAAc,OAAd,CAAuB,QAAUG,CAAV,CAAkB,OAAlB,CAA4BqB,CAA5B,CAAuC,KAA9D,CACH,CAEDnC,CAAC,CAAC,WAAD,CAAD,CAAeoC,EAAf,CAAkB,OAAlB,CAA2B,UAAW,CAElCpC,CAAC,CAAC,IAAD,CAAD,CAAQqC,QAAR,CAAiB,MAAjB,EACA7B,CAAa,CAAC6B,QAAd,CAAuB,MAAvB,EACArC,CAAC,CAAC,UAAD,CAAD,CAAcqC,QAAd,CAAuB,MAAvB,EACArC,CAAC,CAAC,MAAD,CAAD,CAAUqC,QAAV,CAAmB,iBAAnB,EAEA,GAAIC,CAAAA,CAAQ,CAAG9B,CAAa,CAACuB,OAAd,CAAsB,eAAtB,EAAuCL,QAAvC,CAAgD,OAAhD,CAAf,CACA,GAAI,IAAAY,CAAJ,CAAsB,CAClBtC,CAAC,CAAC,YAAD,CAAD,CAAgBuC,OAAhB,CAAwB,CACpBC,SAAS,CAAEhC,CAAa,CAACiC,MAAd,GAAuBC,GADd,CAAxB,CAEG,GAFH,CAGH,CAEDT,CAAS,GAGTpB,CAAS,CAAC0B,OAAV,CAAkB,CACdC,SAAS,CAAE,CADG,CAAlB,CAEG,CAFH,CAGH,CApBD,EAsBAxC,CAAC,CAAC,UAAD,CAAD,CAAcoC,EAAd,CAAiB,OAAjB,CAA0B,UAAW,CACjC5B,CAAa,CAACmC,WAAd,CAA0B,MAA1B,EACA3C,CAAC,CAAC,IAAD,CAAD,CAAQ2C,WAAR,CAAoB,MAApB,EACA3C,CAAC,CAAC,MAAD,CAAD,CAAU2C,WAAV,CAAsB,iBAAtB,CACH,CAJD,EAOA3C,CAAC,CAACS,QAAD,CAAD,CAAYmC,KAAZ,CAAkB,SAASpB,CAAT,CAAY,CAC1B,GAAiB,EAAb,EAAAA,CAAC,CAACqB,OAAN,CAAqB,CACjBrC,CAAa,CAACmC,WAAd,CAA0B,MAA1B,EACA3C,CAAC,CAAC,UAAD,CAAD,CAAc2C,WAAd,CAA0B,MAA1B,EACA3C,CAAC,CAAC,MAAD,CAAD,CAAU2C,WAAV,CAAsB,iBAAtB,CACH,CACJ,CAND,EASA/B,CAAM,CAACwB,EAAP,CAAU,OAAV,CAAmB,UAAW,CAC1Bb,CAAQ,CAACvB,CAAC,CAAC,IAAD,CAAF,CAAR,CACAa,CAAS,CAAC0B,OAAV,CAAkB,CACdC,SAAS,CAAE,CADG,CAAlB,CAEG,CAFH,CAIH,CAND,EASAtB,CAAS,CAACF,CAAD,CAAT,CAEAR,CAAa,CAACG,GAAd,CAAkB,SAAlB,CAA6B,EAA7B,CACH,CAtGD,CAwGH,CApHE,CAsHV,CAvHK,CAAN","sourcesContent":["/* jshint ignore:start */\ndefine(['jquery', 'core/log', 'core/tree'], function($, log, Tree) {\n    return {\n        init: function(siteAdminNodeId) {           \n            // Ensure root node is tabable.\n            var siteAdminNode = $('#' + siteAdminNodeId);\n            var siteAdminLink = siteAdminNode.children('span').first();\n            siteAdminLink.attr('tabindex', 0);\n\n            // Open/Close Settings Menu\n            var settingsblock = $('#block-region-nav-settings');\n\n            // Settings Menu Horizontal Feature\n            // Init / re-init the menu\n            $(document).ajaxComplete(function(event, xhr, settings) {\n                // The block is set to display: none to prevent\n                // weird drag and drop issues caused by absolute\n                // positioning, and also to prevent screenreaders\n                // reading every item on page load.\n                // We temporarily set it to 'block' here to make\n                // sure that the height and width are correctly\n                // calculated. We set it back after.\n                settingsblock.css('display', 'block');\n\n                // Settings Menu Horizontal Feature\n                var branch = $('.tree_item.branch');\n                var blocktree = $('.block_tree.list');\n                var width = blocktree.outerWidth();\n                var sibling = branch.siblings('ul');\n\n                // Increase all branch list height to the tallest\n                function maxheight(element) {\n                    var maxheight = 0;\n                    element.each(function() {\n                        maxheight = ($(this).outerHeight() > maxheight ? $(this).height() : maxheight);\n                    });\n                    element.height(maxheight);\n                    blocktree.height(maxheight);\n                }\n\n                // Events that create the horizontal navigation\n                // by targeting the aria attributes\n                function closenav(e) {\n                    var rootnode = e.hasClass('root_node');\n                    var children = e.siblings('ul').find('.tree_item.branch');\n                    var sib = e.parent().siblings();\n                    var level = e.parents('li.contains_branch').length * 2;\n\n                    if (e.attr('aria-expanded') == 'true') {\n                        level = level - 2;\n                    }\n\n                    children.attr('aria-expanded', 'false');\n                    children.siblings('ul').attr('aria-hidden', 'true');\n                    sib.find('.tree_item.branch').attr('aria-expanded', 'false');\n                    sib.find('.tree_item.branch').siblings('ul').attr('aria-hidden', 'true');\n\n                    blocktree.css('width', 'calc(' + width + 'px + ' + level + 'rem');\n                }\n\n                function fix_width() {\n                    var openbranch = $('.tree_item.branch[aria-expanded=\"true\"]');\n                    var branches = openbranch.length * 2;\n                    blocktree.css('width', 'calc(' + width + 'px + ' + branches + 'rem');\n                }\n\n                $('a.trigger').on('click', function() {\n\n                    $(this).addClass('open');\n                    settingsblock.addClass('show');\n                    $('.overlay').addClass('show');\n                    $('body').addClass('overflow-hidden');\n\n                    var scrollto = settingsblock.parents('.right-navbar').hasClass('stick');\n                    if (scrollto != true) {\n                        $('html, body').animate({\n                            scrollTop: settingsblock.offset().top\n                        }, 200);\n                    }\n\n                    fix_width();\n\n                    // Click the settings button to reset navigation tree\n                    blocktree.animate({\n                        scrollTop: 0\n                    }, 0);\n                });\n\n                $('.overlay').on('click', function() {\n                    settingsblock.removeClass('show');\n                    $(this).removeClass('show');\n                    $('body').removeClass('overflow-hidden');\n                });\n\n                // Close the settings menu with ESC key\n                $(document).keyup(function(e) {\n                    if (e.keyCode == 27) {\n                        settingsblock.removeClass('show');\n                        $('.overlay').removeClass('show');\n                        $('body').removeClass('overflow-hidden');\n                    }\n                });\n\n                // Click branch to open submenu and scroll to the top\n                branch.on('click', function() {\n                    closenav($(this));\n                    blocktree.animate({\n                        scrollTop: 0\n                    }, 0);\n\n                });\n\n                // Call again just in case\n                maxheight(sibling);\n                // Set back once height and width have been calculated.\n                settingsblock.css('display', '');\n            });\n\n        }\n    }\n});\n/* jshint ignore:end */"],"file":"settingsmenu.min.js"}